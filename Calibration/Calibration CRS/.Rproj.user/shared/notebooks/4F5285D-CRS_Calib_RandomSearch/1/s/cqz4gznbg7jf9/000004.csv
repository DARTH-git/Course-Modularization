"0",""
"0",""
"0","###  Run the model for each set of input values ###"
"0",""
"0","# initialize goodness-of-fit vector"
"0","m_GOF <- matrix(nrow = n_samp, ncol = n_target)"
"0","colnames(m_GOF) <- paste0(v_target_names, ""_fit"")"
"0",""
"0","# loop through sampled sets of input values"
"0","for (j in 1:n_samp){"
"0","  "
"0","  ###  Run model for a given parameter set  ###"
"0","  model_res <- run_crs_markov(v_params = m_param_samp[j, ])"
"0","  "
"0","  "
"0","  ###  Calculate goodness-of-fit of model outputs to targets  ###"
"0",""
"0","  # TARGET 1: Survival (""Surv"")"
"0","  # log likelihood  "
"0","  m_GOF[j,1] <- sum(dnorm(x = lst_targets$Surv$value,"
"0","                       mean = model_res$Surv,"
"0","                       sd = lst_targets$Surv$se,"
"0","                       log = T))"
"0","  "
"0","  # weighted sum of squared errors (alternative to log likelihood)"
"0","  # w <- 1/(lst_targets$Surv$se^2)"
"0","  # m_GOF[j,1] <- -sum(w*(lst_targets$Surv$value - v_res)^2)"
"0","  "
"0","  "
"0","  # TARGET 2: (if you had more...)"
"0","  # log likelihood"
"0","  # m_GOF[j,2] <- sum(dnorm(x = lst_targets$Target2$value,"
"0","  #                        mean = model_res$Target2,"
"0","  #                        sd = lst_targets$Target2$se,"
"0","  #                        log = T))"
"0","  "
"0","  "
"0","} # End loop over sampled parameter sets"
"0",""
"0",""
"0","###  Combine fits to the different targets into single GOF  ###"
"0","# can give different targets different weights"
"0","v_weights <- matrix(1, nrow = n_target, ncol = 1)"
"0","# matrix multiplication to calculate weight sum of each GOF matrix row"
"0","v_GOF_overall <- c(m_GOF%*%v_weights)"
"0","# Store in GOF matrix with column name ""Overall"""
"0","m_GOF <- cbind(m_GOF,Overall_fit=v_GOF_overall)"
"0",""
"0","# Calculate computation time"
"0","comp_time <- Sys.time() - t_init"
