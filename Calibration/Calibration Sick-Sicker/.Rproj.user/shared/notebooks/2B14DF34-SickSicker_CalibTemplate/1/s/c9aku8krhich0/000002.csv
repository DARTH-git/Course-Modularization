"0","# record start time of calibration"
"0","t_init <- Sys.time()"
"0",""
"0","###  Bayesian calibration using IMIS  ###"
"0","# define three functions needed by IMIS: prior(x), likelihood(x), sample.prior(n)"
"0","prior <- calc_prior"
"0","likelihood <- calc_likelihood"
"0","sample.prior <- sample_prior"
"0",""
"0","# run IMIS"
"0","fit_imis <- IMIS(B = 1000, # the incremental sample size at each iteration of IMIS"
"0","                 B.re = n_resamp, # the desired posterior sample size"
"0","                 number_k = 10, # the maximum number of iterations in IMIS"
"0","                 D = 0) "
"1","[1]"
"1"," ""10000 likelihoods are evaluated in 0.05 minutes"""
"1","
"
"1","[1]"
"1"," ""Stage   MargLike   UniquePoint   MaxWeight   ESS"""
"1","
"
"1","[1]"
"1","   1.000"
"1"," 168.596"
"1","  70.971"
"1","   0.086"
"1","  25.581"
"1","
"
"1","[1]"
"1","   2.000"
"1"," 168.481"
"1"," 203.922"
"1","   0.026"
"1"," 114.171"
"1","
"
"1","[1]"
"1","   3.000"
"1"," 168.561"
"1"," 294.355"
"1","   0.012"
"1"," 212.340"
"1","
"
"1","[1]"
"1","   4.000"
"1"," 168.565"
"1"," 487.372"
"1","   0.008"
"1"," 472.542"
"1","
"
"1","[1]"
"1","   5.000"
"1"," 168.534"
"1"," 582.035"
"1","   0.003"
"1"," 753.620"
"1","
"
"1","[1]"
"1","   6.000"
"1"," 168.539"
"1"," 642.677"
"1","   0.002"
"1"," 946.674"
"1","
"
"0","# obtain draws from posterior"
"0","m_calib_res <- fit_imis$resample"
"0",""
"0","# Calculate log-likelihood (overall fit) and posterior probability of each sample"
"0","m_calib_res <- cbind(m_calib_res, "
"0","                      ""Overall_fit"" = calc_log_lik(m_calib_res[,v_param_names]),"
"0","                      ""Posterior_prob"" = calc_post(m_calib_res[,v_param_names]))"
"0",""
"0","# normalize posterior probability"
"0","m_calib_res[,""Posterior_prob""] <- m_calib_res[,""Posterior_prob""]/sum(m_calib_res[,""Posterior_prob""])"
"0",""
"0","# Calculate computation time"
"0","comp_time <- Sys.time() - t_init"
