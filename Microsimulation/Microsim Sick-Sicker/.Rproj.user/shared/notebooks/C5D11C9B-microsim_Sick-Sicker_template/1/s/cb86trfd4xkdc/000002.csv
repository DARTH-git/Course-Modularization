"0","Probs <- function(M_t, df_X, t) { "
"0","  # Arguments:"
"0","    # M_t: health state occupied by individual i at cycle t (character variable)"
"0","    # df_X:     data frame with individual characteristics data "
"0","  # t:     current cycle "
"0","# Returns: "
"0","  #   transition probabilities for that cycle"
"0","  "
"0","  # create matrix of state transition probabilities  "
"0","  m_p_t           <- matrix(0, nrow = n_s, ncol = n_i) "
"0","  rownames(m_p_t) <-  v_n  # give the state names to the rows"
"0","  "
"0","  # lookup baseline probability and rate of dying based on individual characteristics"
"0","  p_HD_all <- inner_join(df_X, p_mort, by = c(""Age""))"
"0","  p_HD     <- p_HD_all[M_t == ""H"",""p_HD""]"
"0","  "
"0","  # update the m_p with the appropriate probabilities   "
"0","  # transition probabilities when healthy"
"0","  m_p_t[, M_t == ""H""]  <- rbind(1 - p_HS1 - p_HD, p_HS1, 0, p_HD)                              "
"0","  # transition probabilities when sick"
"0","  m_p_t[, M_t == ""S1""] <- rbind(p_S1H, 1 - p_S1H - p_S1S2 - p_S1D, p_S1S2, p_S1D)  "
"0","  # transition probabilities when sicker"
"0","  m_p_t[, M_t == ""S2""] <- rbind(0, 0, 1 - p_S2D, p_S2D)                                            "
"0","  # transition probabilities when dead   "
"0","  m_p_t[, M_t == ""D""]  <- rbind(0, 0, 0, 1)                                                        "
"0","  "
"0","  return(t(m_p_t))"
"0","}       "
