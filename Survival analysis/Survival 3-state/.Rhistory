data=tglong,method="breslow")
summary(cx)
# new data, to check whether results are the same for transition 1 as
# those in appendix E.1 of Therneau & Grambsch (2000)
newdata <- data.frame(trans=1:3,x1.1=c(0,0,0),x2.2=c(0,1,0),strata=1:3)
HvH <- msfit(cx,newdata,trans=tmat)
# probtrans
pt <- probtrans(HvH,predt=0)
# predictions from state 1
pt[[2]]
pt
probtrans
tmat <- trans.illdeath()
# data in wide format, for transition 1 this is dataset E1 of
# Therneau & Grambsch (2000)
tg <- data.frame(illt=c(1,1,6,6,8,9),ills=c(1,0,1,1,0,1),
dt=c(5,1,9,7,8,12),ds=c(1,1,1,1,1,1),
x1=c(1,1,1,0,0,0),x2=c(6:1))
# data in long format using msprep
tglong <- msprep(time=c(NA,"illt","dt"),status=c(NA,"ills","ds"),
data=tg,keep=c("x1","x2"),trans=tmat)
# events
events(tglong)
table(tglong$status,tglong$to,tglong$from)
# expanded covariates
tglong <- expand.covs(tglong,c("x1","x2"))
# Cox model with different covariate
cx <- coxph(Surv(Tstart,Tstop,status)~x1.1+x2.2+strata(trans),
data=tglong,method="breslow")
summary(cx)
# new data, to check whether results are the same for transition 1 as
# those in appendix E.1 of Therneau & Grambsch (2000)
newdata <- data.frame(trans=1:3,x1.1=c(0,0,0),x2.2=c(0,1,0),strata=1:3)
HvH <- msfit(cx,newdata,trans=tmat)
# probtrans
pt <- probtrans(HvH,predt=0)
# predictions from state 1
pt
netmeta
install.package("netmeta")
install.packages("netmeta")
14-9
18866-13886
y <- c(278,326, 547,639,916,2019, 2744, 4474,5974,7783, 9776, 11791, 14348, 17205, 19740, 24630, 27400, 30600, 34100)
t_y <- 1:19
t   <- 1:(max(t_y)-1)
t2 <- t^2
logt  <- log(t)
logt2 <- log(t2)
maxt  <- 60
dy <- diff(y)
fit  <- glm(dy ~ t , family = "poisson")
fit2 <- glm(dy ~ t + t2, family = "poisson")
fit3 <- glm(dy ~ t + logt , family = "poisson")
fit4 <- glm(dy ~ t + t2 + logt2, family = "poisson")
new  <- data.frame(t = 1:maxt)
new2 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2)
new3 <- data.frame(t = 1:maxt, logt = log(1:maxt))
new4 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2, logt2 = log((1:maxt)^2))
pred1<-  cumsum(c(y[1],predict(fit,type="response", newdata = new )))
pred2<-  cumsum(c(y[1],predict(fit2,type="response", newdata = new2 )))
pred3<-  cumsum(c(y[1],predict(fit3,type="response", newdata = new3 )))
pred4<-  cumsum(c(y[1],predict(fit4,type="response", newdata = new4 )))
cbind(pred1,pred2, pred3,pred4)
library(ggplot2)
fit_rate <- 0
for (i in 1:(max(t_y)-1))
fit_rate[i] <- glm(y[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate <- data.frame( t= t, y = fit_rate)
ggplot(rate,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,100000) +
xlim(1,40) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","least likely",
"data"),
values = c("red", "green", "blue","yellow","black"))+
aes(x = t_y , y = y, col = "data" )+
geom_line()+
# geom_line(aes(x = 1:31, y = pred1, color = "uber pessimist" ))+
geom_line(aes(x = 1:(maxt + 1), y = pred2, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred3, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred4, color = "more likely" ))
new4
fit4
fit3
fit2
fit
y2 <- c(4,6, 8,14,25,40, 57, 64,87,105, 118, 153, 173, 183, 188, 212,  227, 265, 317)
dy2 <- diff(y2)
fit2 <- glm(dy2 ~ t , family = "poisson")
fit22 <- glm(dy2 ~ t + t2, family = "poisson")
fit32 <- glm(dy2 ~ t + logt , family = "poisson")
fit42 <- glm(dy2 ~ t + t2 + logt2, family = "poisson")
pred12<-  cumsum(c(y2[1],predict(fit2,type="response", newdata = new )))
pred22<-  cumsum(c(y2[1],predict(fit22,type="response", newdata = new2 )))
pred32<-  cumsum(c(y2[1],predict(fit32,type="response", newdata = new3 )))
pred42<-  cumsum(c(y2[1],predict(fit42,type="response", newdata = new4 )))
cbind(pred12,pred22, pred32,pred42)
se.pred32<-  sqrt(cumsum(predict(fit32,type="response",se.fit = T, newdata = new3 )$se.fit^2))
se.pred42<-  sqrt(cumsum(predict(fit42,type="response", se.fit = T, newdata = new4 )$se.fit^2))
se.pred22<-  sqrt(cumsum(predict(fit22,type="response", se.fit = T, newdata = new2 )$se.fit^2))
library(ggplot2)
fit_rate2 <- 0
for (i in t)
fit_rate2[i] <- glm(y2[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate2 <- data.frame( t= t2, y = fit_rate2)
ggplot(rate2,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
rate2
y2
t_y
ggplot()+
ylim(0,5000) +
xlim(1,60) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","Lower CI",
"data"),
values = c("red", "green", "blue","yellow","black"))+
#aes(x = t_y , y = y2, col = "data" )+
#geom_line()+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred32 - 1.96 *se.pred32,ymax =pred32 + 1.96 *se.pred32 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred42 - 1.96 *se.pred42,ymax =pred42 + 1.96 *se.pred42 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred22 - 1.96 *se.pred22,ymax =pred22 + 1.96 *se.pred22 ), alpha =0.3)+
geom_line(aes(x = 1:(maxt + 1), y = pred32, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred42, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred22, color = "more likely" ))
fit42
fit32
fit22
fit2
fit42
fit22
fit32
fit42
dy2
δυ2/υ2[-1]
dy2/y2[-1]
fit_rate2
plot(dy2/y2[-1] ,fit_rate2)
ggplot(rate2,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
y <- c(278,326, 547,639,916,2019, 2744, 4474,5974,7783, 9776, 11791, 14348, 17205, 19740, 24630, 27400, 30600, 34100, 36800)
t_y <- 1:length(y)
t   <- 1:(max(t_y)-1)
t2 <- t^2
logt  <- log(t)
logt2 <- log(t2)
maxt  <- 60
dy <- diff(y)
fit  <- glm(dy ~ t , family = "poisson")
fit2 <- glm(dy ~ t + t2, family = "poisson")
fit3 <- glm(dy ~ t + logt , family = "poisson")
fit4 <- glm(dy ~ t + t2 + logt2, family = "poisson")
new  <- data.frame(t = 1:maxt)
new2 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2)
new3 <- data.frame(t = 1:maxt, logt = log(1:maxt))
new4 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2, logt2 = log((1:maxt)^2))
pred1<-  cumsum(c(y[1],predict(fit,type="response", newdata = new )))
pred2<-  cumsum(c(y[1],predict(fit2,type="response", newdata = new2 )))
pred3<-  cumsum(c(y[1],predict(fit3,type="response", newdata = new3 )))
pred4<-  cumsum(c(y[1],predict(fit4,type="response", newdata = new4 )))
cbind(pred1,pred2, pred3,pred4)
library(ggplot2)
fit_rate <- 0
for (i in 1:(max(t_y)-1))
fit_rate[i] <- glm(y[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate <- data.frame( t= t, y = fit_rate)
ggplot(rate,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,100000) +
xlim(1,40) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","least likely",
"data"),
values = c("red", "green", "blue","yellow","black"))+
aes(x = t_y , y = y, col = "data" )+
geom_line()+
# geom_line(aes(x = 1:31, y = pred1, color = "uber pessimist" ))+
geom_line(aes(x = 1:(maxt + 1), y = pred2, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred3, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred4, color = "more likely" ))
y2 <- c(4,6, 8,14,25,40, 57, 64,87,105, 118, 153, 173, 183, 188, 212,  227, 265, 317, 343)
dy2 <- diff(y2)
fit2 <- glm(dy2 ~ t , family = "poisson")
fit22 <- glm(dy2 ~ t + t2, family = "poisson")
fit32 <- glm(dy2 ~ t + logt , family = "poisson")
fit42 <- glm(dy2 ~ t + t2 + logt2, family = "poisson")
pred12<-  cumsum(c(y2[1],predict(fit2,type="response", newdata = new )))
pred22<-  cumsum(c(y2[1],predict(fit22,type="response", newdata = new2 )))
pred32<-  cumsum(c(y2[1],predict(fit32,type="response", newdata = new3 )))
pred42<-  cumsum(c(y2[1],predict(fit42,type="response", newdata = new4 )))
cbind(pred12,pred22, pred32,pred42)
se.pred32<-  sqrt(cumsum(predict(fit32,type="response",se.fit = T, newdata = new3 )$se.fit^2))
se.pred42<-  sqrt(cumsum(predict(fit42,type="response", se.fit = T, newdata = new4 )$se.fit^2))
se.pred22<-  sqrt(cumsum(predict(fit22,type="response", se.fit = T, newdata = new2 )$se.fit^2))
library(ggplot2)
fit_rate2 <- 0
for (i in t)
fit_rate2[i] <- glm(y2[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate2 <- data.frame( t= t2, y = fit_rate2)
ggplot(rate2,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,5000) +
xlim(1,60) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","Lower CI",
"data"),
values = c("red", "green", "blue","yellow","black"))+
#aes(x = t_y , y = y2, col = "data" )+
#geom_line()+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred32 - 1.96 *se.pred32,ymax =pred32 + 1.96 *se.pred32 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred42 - 1.96 *se.pred42,ymax =pred42 + 1.96 *se.pred42 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred22 - 1.96 *se.pred22,ymax =pred22 + 1.96 *se.pred22 ), alpha =0.3)+
geom_line(aes(x = 1:(maxt + 1), y = pred32, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred42, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred22, color = "more likely" ))
fit32
fit42
fit22
fit2
y <- c(278,326, 547,639,916,2019, 2744, 4474,5974,7783, 9776, 11791, 14348, 17205, 19740, 24630, 27400, 30600, 34100, 36800, 39800)
t_y <- 1:length(y)
t   <- 1:(max(t_y)-1)
t2 <- t^2
logt  <- log(t)
logt2 <- log(t2)
maxt  <- 60
dy <- diff(y)
fit  <- glm(dy ~ t , family = "poisson")
fit2 <- glm(dy ~ t + t2, family = "poisson")
fit3 <- glm(dy ~ t + logt , family = "poisson")
fit4 <- glm(dy ~ t + t2 + logt2, family = "poisson")
fit4
fit3
fit2
new  <- data.frame(t = 1:maxt)
new2 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2)
new3 <- data.frame(t = 1:maxt, logt = log(1:maxt))
new4 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2, logt2 = log((1:maxt)^2))
pred1<-  cumsum(c(y[1],predict(fit,type="response", newdata = new )))
pred2<-  cumsum(c(y[1],predict(fit2,type="response", newdata = new2 )))
pred3<-  cumsum(c(y[1],predict(fit3,type="response", newdata = new3 )))
pred4<-  cumsum(c(y[1],predict(fit4,type="response", newdata = new4 )))
cbind(pred1,pred2, pred3,pred4)
library(ggplot2)
fit_rate <- 0
for (i in 1:(max(t_y)-1))
fit_rate[i] <- glm(y[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate <- data.frame( t= t, y = fit_rate)
ggplot(rate,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,100000) +
xlim(1,40) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","least likely",
"data"),
values = c("red", "green", "blue","yellow","black"))+
aes(x = t_y , y = y, col = "data" )+
geom_line()+
# geom_line(aes(x = 1:31, y = pred1, color = "uber pessimist" ))+
geom_line(aes(x = 1:(maxt + 1), y = pred2, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred3, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred4, color = "more likely" ))
y2 <- c(4,6, 8,14,25,40, 57, 64,87,105, 118, 153, 173, 183, 188, 212,  227, 265, 317, 343, 361)
dy2 <- diff(y2)
fit2 <- glm(dy2 ~ t , family = "poisson")
fit22 <- glm(dy2 ~ t + t2, family = "poisson")
fit32 <- glm(dy2 ~ t + logt , family = "poisson")
fit42 <- glm(dy2 ~ t + t2 + logt2, family = "poisson")
pred12<-  cumsum(c(y2[1],predict(fit2,type="response", newdata = new )))
pred22<-  cumsum(c(y2[1],predict(fit22,type="response", newdata = new2 )))
pred32<-  cumsum(c(y2[1],predict(fit32,type="response", newdata = new3 )))
pred42<-  cumsum(c(y2[1],predict(fit42,type="response", newdata = new4 )))
cbind(pred12,pred22, pred32,pred42)
se.pred32<-  sqrt(cumsum(predict(fit32,type="response",se.fit = T, newdata = new3 )$se.fit^2))
se.pred42<-  sqrt(cumsum(predict(fit42,type="response", se.fit = T, newdata = new4 )$se.fit^2))
se.pred22<-  sqrt(cumsum(predict(fit22,type="response", se.fit = T, newdata = new2 )$se.fit^2))
library(ggplot2)
fit_rate2 <- 0
for (i in t)
fit_rate2[i] <- glm(y2[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate2 <- data.frame( t= t2, y = fit_rate2)
ggplot(rate2,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,5000) +
xlim(1,60) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","Lower CI",
"data"),
values = c("red", "green", "blue","yellow","black"))+
#aes(x = t_y , y = y2, col = "data" )+
#geom_line()+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred32 - 1.96 *se.pred32,ymax =pred32 + 1.96 *se.pred32 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred42 - 1.96 *se.pred42,ymax =pred42 + 1.96 *se.pred42 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred22 - 1.96 *se.pred22,ymax =pred22 + 1.96 *se.pred22 ), alpha =0.3)+
geom_line(aes(x = 1:(maxt + 1), y = pred32, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred42, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred22, color = "more likely" ))
fit42
fit32
fit22
fit2
fit42
y <- c(278,326, 547,639,916,2019, 2744, 4474,5974,7783, 9776, 11791, 14348, 17205, 19740, 24630, 27400, 30600, 34100, 36800, 39800, 42300)
t_y <- 1:length(y)
t   <- 1:(max(t_y)-1)
t2 <- t^2
logt  <- log(t)
logt2 <- log(t2)
maxt  <- 60
dy <- diff(y)
fit  <- glm(dy ~ t , family = "poisson")
fit2 <- glm(dy ~ t + t2, family = "poisson")
fit3 <- glm(dy ~ t + logt , family = "poisson")
fit4 <- glm(dy ~ t + t2 + logt2, family = "poisson")
new  <- data.frame(t = 1:maxt)
new2 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2)
new3 <- data.frame(t = 1:maxt, logt = log(1:maxt))
new4 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2, logt2 = log((1:maxt)^2))
pred1<-  cumsum(c(y[1],predict(fit,type="response", newdata = new )))
pred2<-  cumsum(c(y[1],predict(fit2,type="response", newdata = new2 )))
pred3<-  cumsum(c(y[1],predict(fit3,type="response", newdata = new3 )))
pred4<-  cumsum(c(y[1],predict(fit4,type="response", newdata = new4 )))
cbind(pred1,pred2, pred3,pred4)
library(ggplot2)
fit_rate <- 0
for (i in 1:(max(t_y)-1))
fit_rate[i] <- glm(y[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate <- data.frame( t= t, y = fit_rate)
ggplot(rate,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,100000) +
xlim(1,40) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","least likely",
"data"),
values = c("red", "green", "blue","yellow","black"))+
aes(x = t_y , y = y, col = "data" )+
geom_line()+
# geom_line(aes(x = 1:31, y = pred1, color = "uber pessimist" ))+
geom_line(aes(x = 1:(maxt + 1), y = pred2, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred3, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred4, color = "more likely" ))
ggplot(rate,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
y2 <- c(4,6, 8,14,25,40, 57, 64,87,105, 118, 153, 173, 183, 188, 212,  227, 265, 317, 343, 361, 457)
dy2 <- diff(y2)
fit2 <- glm(dy2 ~ t , family = "poisson")
fit22 <- glm(dy2 ~ t + t2, family = "poisson")
fit32 <- glm(dy2 ~ t + logt , family = "poisson")
fit42 <- glm(dy2 ~ t + t2 + logt2, family = "poisson")
fit42
fit32
fit22
fit2
pred12<-  cumsum(c(y2[1],predict(fit2,type="response", newdata = new )))
pred22<-  cumsum(c(y2[1],predict(fit22,type="response", newdata = new2 )))
pred32<-  cumsum(c(y2[1],predict(fit32,type="response", newdata = new3 )))
pred42<-  cumsum(c(y2[1],predict(fit42,type="response", newdata = new4 )))
cbind(pred12,pred22, pred32,pred42)
se.pred32<-  sqrt(cumsum(predict(fit32,type="response",se.fit = T, newdata = new3 )$se.fit^2))
se.pred42<-  sqrt(cumsum(predict(fit42,type="response", se.fit = T, newdata = new4 )$se.fit^2))
se.pred22<-  sqrt(cumsum(predict(fit22,type="response", se.fit = T, newdata = new2 )$se.fit^2))
library(ggplot2)
fit_rate2 <- 0
for (i in t)
fit_rate2[i] <- glm(y2[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate2 <- data.frame( t= t2, y = fit_rate2)
ggplot(rate2,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,5000) +
xlim(1,60) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","Lower CI",
"data"),
values = c("red", "green", "blue","yellow","black"))+
#aes(x = t_y , y = y2, col = "data" )+
#geom_line()+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred32 - 1.96 *se.pred32,ymax =pred32 + 1.96 *se.pred32 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred42 - 1.96 *se.pred42,ymax =pred42 + 1.96 *se.pred42 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred22 - 1.96 *se.pred22,ymax =pred22 + 1.96 *se.pred22 ), alpha =0.3)+
geom_line(aes(x = 1:(maxt + 1), y = pred32, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred42, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred22, color = "more likely" ))
y <- c(278,326, 547,639,916,2019, 2744, 4474,5974,7783, 9776, 11791, 14348, 17205, 19740, 24630, 27400, 30600, 34100, 36800, 39800, 42300)
t_y <- 1:length(y)
t   <- 1:(max(t_y)-1)
t2 <- t^2
logt  <- log(t)
logt2 <- log(t2)
maxt  <- 60
dy <- diff(y)
fit  <- glm(dy ~ t , family = "poisson")
fit2 <- glm(dy ~ t + t2, family = "poisson")
fit3 <- glm(dy ~ t + logt , family = "poisson")
fit4 <- glm(dy ~ t + t2 + logt2, family = "poisson")
new  <- data.frame(t = 1:maxt)
new2 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2)
new3 <- data.frame(t = 1:maxt, logt = log(1:maxt))
new4 <- data.frame(t = 1:maxt, t2 = (1:maxt)^2, logt2 = log((1:maxt)^2))
pred1<-  cumsum(c(y[1],predict(fit,type="response", newdata = new )))
pred2<-  cumsum(c(y[1],predict(fit2,type="response", newdata = new2 )))
pred3<-  cumsum(c(y[1],predict(fit3,type="response", newdata = new3 )))
pred4<-  cumsum(c(y[1],predict(fit4,type="response", newdata = new4 )))
cbind(pred1,pred2, pred3,pred4)
library(ggplot2)
fit_rate <- 0
for (i in 1:(max(t_y)-1))
fit_rate[i] <- glm(y[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate <- data.frame( t= t, y = fit_rate)
ggplot(rate,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,100000) +
xlim(1,40) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","least likely",
"data"),
values = c("red", "green", "blue","yellow","black"))+
aes(x = t_y , y = y, col = "data" )+
geom_line()+
# geom_line(aes(x = 1:31, y = pred1, color = "uber pessimist" ))+
geom_line(aes(x = 1:(maxt + 1), y = pred2, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred3, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred4, color = "more likely" ))
y2 <- c(4,6, 8,14,25,40, 57, 64,87,105, 118, 153, 173, 183, 188, 212,  227, 265, 317, 343, 361, 457)
dy2 <- diff(y2)
fit2 <- glm(dy2 ~ t , family = "poisson")
fit22 <- glm(dy2 ~ t + t2, family = "poisson")
fit32 <- glm(dy2 ~ t + logt , family = "poisson")
fit42 <- glm(dy2 ~ t + t2 + logt2, family = "poisson")
pred12<-  cumsum(c(y2[1],predict(fit2,type="response", newdata = new )))
pred22<-  cumsum(c(y2[1],predict(fit22,type="response", newdata = new2 )))
pred32<-  cumsum(c(y2[1],predict(fit32,type="response", newdata = new3 )))
pred42<-  cumsum(c(y2[1],predict(fit42,type="response", newdata = new4 )))
cbind(pred12,pred22, pred32,pred42)
se.pred32<-  sqrt(cumsum(predict(fit32,type="response",se.fit = T, newdata = new3 )$se.fit^2))
se.pred42<-  sqrt(cumsum(predict(fit42,type="response", se.fit = T, newdata = new4 )$se.fit^2))
se.pred22<-  sqrt(cumsum(predict(fit22,type="response", se.fit = T, newdata = new2 )$se.fit^2))
library(ggplot2)
fit_rate2 <- 0
for (i in t)
fit_rate2[i] <- glm(y2[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate2 <- data.frame( t= t2, y = fit_rate2)
ggplot(rate2,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
rate2
y2 <- c(4,6, 8,14,25,40, 57, 64,87,105, 118, 153, 173, 183, 188, 212,  227, 265, 317, 343, 361, 457)
dy2 <- diff(y2)
fit2 <- glm(dy2 ~ t , family = "poisson")
fit22 <- glm(dy2 ~ t + t2, family = "poisson")
fit32 <- glm(dy2 ~ t + logt , family = "poisson")
fit42 <- glm(dy2 ~ t + t2 + logt2, family = "poisson")
pred12<-  cumsum(c(y2[1],predict(fit2,type="response", newdata = new )))
pred22<-  cumsum(c(y2[1],predict(fit22,type="response", newdata = new2 )))
pred32<-  cumsum(c(y2[1],predict(fit32,type="response", newdata = new3 )))
pred42<-  cumsum(c(y2[1],predict(fit42,type="response", newdata = new4 )))
cbind(pred12,pred22, pred32,pred42)
se.pred32<-  sqrt(cumsum(predict(fit32,type="response",se.fit = T, newdata = new3 )$se.fit^2))
se.pred42<-  sqrt(cumsum(predict(fit42,type="response", se.fit = T, newdata = new4 )$se.fit^2))
se.pred22<-  sqrt(cumsum(predict(fit22,type="response", se.fit = T, newdata = new2 )$se.fit^2))
library(ggplot2)
fit_rate2 <- 0
for (i in t)
fit_rate2[i] <- glm(y2[i:(i+1)]~t_y[i:(i+1)], family = "poisson")$coefficients[2]
rate2 <- data.frame( t= t2, y = fit_rate2)
ggplot(rate2,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
t
t
t
y
t
ggplot(rate2,aes(x = t, y = y)) +geom_line() + ylim(0,1)+ geom_smooth(method = "loess",se= F)
ggplot()+
ylim(0,5000) +
xlim(1,60) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","Lower CI",
"data"),
values = c("red", "green", "blue","yellow","black"))+
#aes(x = t_y , y = y2, col = "data" )+
#geom_line()+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred32 - 1.96 *se.pred32,ymax =pred32 + 1.96 *se.pred32 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred42 - 1.96 *se.pred42,ymax =pred42 + 1.96 *se.pred42 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred22 - 1.96 *se.pred22,ymax =pred22 + 1.96 *se.pred22 ), alpha =0.3)+
geom_line(aes(x = 1:(maxt + 1), y = pred32, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred42, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred22, color = "more likely" ))
ggplot()+
ylim(0,5000) +
xlim(1,60) +
scale_colour_manual("",
breaks = c( "more likely", "less likely",
"likely","Lower CI",
"data"),
values = c("red", "green", "blue","yellow","black"))+
#aes(x = t_y , y = y2, col = "data" )+
#geom_line()+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred32 - 1.96 *se.pred32,ymax =pred32 + 1.96 *se.pred32 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred42 - 1.96 *se.pred42,ymax =pred42 + 1.96 *se.pred42 ), alpha =0.3)+
geom_ribbon( aes(x = 1:(maxt + 1),ymin = pred22 - 1.96 *se.pred22,ymax =pred22 + 1.96 *se.pred22 ), alpha =0.3)+
geom_line(aes(x = 1:(maxt + 1), y = pred32, color = "less likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred42, color = "likely" )) +
geom_line(aes(x = 1:(maxt + 1), y = pred22, color = "more likely" ))
dim(y)
length(y)
