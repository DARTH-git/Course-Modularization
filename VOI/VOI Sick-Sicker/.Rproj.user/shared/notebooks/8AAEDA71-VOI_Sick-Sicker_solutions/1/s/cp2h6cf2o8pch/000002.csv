"0","# Select parameters with positive EVPPI"
"0","sel_params <- c(3, 4, 10, 12, 14)"
"0","n_params <- length(sel_params)"
"0","# Effective (prior) Sample size"
"0","n0 <- numeric(length(sel_params))"
"0","n0[1] <- 84+800    # p.S1S2 ~ Beta(84, 800)"
"0","n0[2] <- 10+2000   # p.HD ~ Beta(10,2000)"
"0","n0[3] <- 73.5      # cTrt ~ Gamma(73.5, 163.3) -> likelihood ~ Exponential"
"0","n0[4] <- 50        # u.S1 ~ N(.75, .02 / sqrt(50) = )"
"0","n0[5] <- 20        # u.Trt ~ N(.95, 0.02)"
"0",""
"0","n <- c(0, 100, seq(200, 2000, by = 200))"
"0","n_samples <- length(n)"
"0",""
"0","# Each parameter individually (only assuming linear relationship)"
"0","# Initialize EVSI matrix for each parameters"
"0","evsi <- data.frame(N = n, matrix(0, nrow = n_samples, ncol = n_params))"
"0",""
"0","# Name columns of EVPSI matrix with parameter names"
"0","colnames(evsi)[-1] <- names_params[sel_params]"
"0",""
"0","# Compute EVSI for all parameters separately"
"0","for (p in 1:n_params){ # p <- 1"
"0","  print(paste(""Computing EVSI of parameter"", names_params[p]))"
"0","  # Update loss based on gaussian approximation for each sample of interest"
"0","  for (nSamp in 1:n_samples){ # nSamp <- 10"
"0","    Ltilde1 <- predict.ga(lmm1[[sel_params[p]]], n = n[nSamp], n0 = n0[p])"
"0","    Ltilde2 <- predict.ga(lmm2[[sel_params[p]]], n = n[nSamp], n0 = n0[p])"
"0","    ## Combine losses into one matrix"
"0","    Ltilde <- cbind(Ltilde1, Ltilde2)"
"0","    ### Apply EVSI equation"
"0","    evsi[nSamp, p+1] <- mean(rowMaxs(Ltilde))"
"0","  }"
"0","}"
"1","[1]"
"1"," ""Computing EVSI of parameter p.HS1"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.319"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.319"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.43"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.43"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.558"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.558"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.636"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.636"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.689"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.689"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.729"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.729"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.759"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.759"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.783"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.783"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.803"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.803"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.819"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.819"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.833"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.833"""
"1","
"
"1","[1]"
"1"," ""Computing EVSI of parameter p.S1H"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.218"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.218"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.301"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.301"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.407"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.407"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.479"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.479"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.534"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.534"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.576"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.576"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.611"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.611"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.641"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.641"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.666"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.666"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.687"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.687"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.706"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.706"""
"1","
"
"1","[1]"
"1"," ""Computing EVSI of parameter p.S1S2"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.759"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.759"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.855"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.855"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.919"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.919"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.944"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.944"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.957"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.957"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.965"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.965"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.971"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.971"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.975"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.975"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.978"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.978"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.98"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.98"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.982"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.982"""
"1","
"
"1","[1]"
"1"," ""Computing EVSI of parameter p.HD"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.816"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.816"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.894"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.894"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.943"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.943"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.961"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.961"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.97"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.97"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.976"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.976"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.98"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.98"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.983"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.983"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.985"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.985"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.986"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.986"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.988"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.988"""
"1","
"
"1","[1]"
"1"," ""Computing EVSI of parameter rr.S1"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.913"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.913"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.953"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.953"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.976"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.976"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.984"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.984"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.988"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.988"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.99"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.99"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.992"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.992"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.993"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.993"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.994"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.994"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.994"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.994"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.995"""
"1","
"
"1","[1]"
"1"," ""Variance reduction factor = 0.995"""
"1","
"
"0","# Plotting EVSI"
"0","# Create EVSI data frame for plotting in decreasing order of EVPPI"
"0","evsi_gg <- melt(evsi, id.vars = ""N"", "
"0","                variable.name = ""Parameter"", "
"0","                value.name = ""evsi"")"
"0","evsi_gg$Parameter <- factor((evsi_gg$Parameter), "
"0","                            levels = names_params[order(evppi_splines_gg$EVPPI, decreasing = TRUE)])"
"0",""
"0","# Plot evsi using ggplot2 package"
"0","ggplot(evsi_gg, aes(x = N, y = evsi)) +  # colour = Parameter"
"0","  geom_line() +"
"0","  geom_point() +"
"0","  facet_wrap(~ Parameter) +  # scales = ""free_y"""
"0","  ggtitle(""Expected Value of Sample Information (EVSI)"") +"
"0","  xlab(""Sample size (n)"") +"
"0","  ylab(""$"") +"
"0","  scale_x_continuous(breaks = number_ticks(5)) + "
"0","  scale_y_continuous(breaks = number_ticks(6), labels = dollar) + "
"0","  theme_bw(base_size = 14)"
