% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Three-strategy decision tree in R - HVE},
  pdfauthor={The DARTH workgroup},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Three-strategy decision tree in R - HVE}
\author{The DARTH workgroup}
\date{}

\begin{document}
\maketitle

Developed by the Decision Analysis in R for Technologies in Health
(DARTH) workgroup: Fernando Alarid-Escudero, PhD\\
Eva A. Enns, MS, PhD M.G. Myriam Hunink, MD, PhD Hawre J. Jalal, MD, PhD
Eline Krijkamp, PhD Petros Pechlivanoglou, PhD Alan Yang, MSc

Please cite relevant publications when using this code, see suggestions
below.

\newpage

Change \texttt{eval} to \texttt{TRUE} if you want to knit this document.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rm}\NormalTok{(}\AttributeTok{list =} \FunctionTok{ls}\NormalTok{())      }\CommentTok{\# clear memory (removes all the variables from the workspace)}
\end{Highlighting}
\end{Shaded}

\hypertarget{case-example}{%
\section{00 Case example}\label{case-example}}

Viral encephalitis can be caused by herpes viruses (HVE) or other
viruses (OVE). Herpes viruses cause approximately 52\% of cases of viral
encephalitis. Without treatment, the risk of complications (death or
severe sequelae) for HVE is 71\%; for OVE, the risk is only 1\%. A drug,
vidarabine, decreases the likelihood of complications due to HVE from
71\% down to 36\%. However, among OVE patients, treatment with
vidarabine is associated with severe side effects, increasing the risk
of complications from the 1\% baseline to 20\%. It is possible to obtain
a definitive diagnosis of HVE by means of a brain biopsy, but the
procedure itself also has a 5\% probability of inducing complications.

You are tasked with evaluating the healthcare costs and benefits
associated with three possible management strategies (no treatment,
vidarabine treatment, or brain biopsy followed by vidarabine treatment
for those who are diagnosed with HVE). Benefits will be measured in
terms of quality-adjusted life-years (QALYs).

The healthcare cost of a case of viral encephalitis without
complications is \$1,200; however, if complications occur, the cost
rises to \$9,000. The cost of vidarabine treatment is \$9,500, while a
brain biopsy is a \$25,000 procedure.

A patient who recovers from viral encephalitis without complications has
an average of 20 remaining QALYs; however, a patient who experiences
complications has an average of 19 remaining QALYs. Since a brain biopsy
is an unpleasant procedure, patients who undergo it also experience a
one-time loss of 0.01 QALYs regardless of the outcome of the biopsy.

Parameters are summarized in Table 1 and the tree structure is shown in
the figure below.

\hypertarget{load-packages}{%
\section{01 Load packages}\label{load-packages}}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{require}\NormalTok{(}\StringTok{\textquotesingle{}pacman\textquotesingle{}}\NormalTok{)) }\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}pacman\textquotesingle{}}\NormalTok{); }\FunctionTok{library}\NormalTok{(pacman) }\CommentTok{\# use this package to conveniently install other packages}
\CommentTok{\# load (install if required) packages from CRAN}
\FunctionTok{p\_load}\NormalTok{(}\StringTok{"dplyr"}\NormalTok{, }\StringTok{"devtools"}\NormalTok{, }\StringTok{"scales"}\NormalTok{, }\StringTok{"ellipse"}\NormalTok{, }\StringTok{"ggplot2"}\NormalTok{, }\StringTok{"lazyeval"}\NormalTok{, }\StringTok{"igraph"}\NormalTok{,  }\StringTok{"ggraph"}\NormalTok{, }\StringTok{"reshape2"}\NormalTok{, }\StringTok{"knitr"}\NormalTok{, }\StringTok{"stringr"}\NormalTok{, }\StringTok{"dampack"}\NormalTok{)}
\CommentTok{\# load (install if required) packages from GitHub}
\FunctionTok{p\_load\_gh}\NormalTok{(}\StringTok{"DARTH{-}git/darthtools"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{load-functions}{%
\section{02 Load functions}\label{load-functions}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# all functions are in the darthtools package so no need for additional functions}
\end{Highlighting}
\end{Shaded}

\hypertarget{define-parameter-input-values}{%
\section{03 Define parameter input
values}\label{define-parameter-input-values}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{v\_names\_str    }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"No Tx"}\NormalTok{, }\StringTok{"Tx All"}\NormalTok{, }\StringTok{"Biopsy"}\NormalTok{)  }\CommentTok{\# names of strategies, no treatment, treatment and biopspy}
\NormalTok{n\_str          }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(v\_names\_str)             }\CommentTok{\# number of strategies}
\NormalTok{wtp            }\OtherTok{\textless{}{-}} \DecValTok{100000}                          \CommentTok{\# willingness to pay threshold}

\CommentTok{\# Probabilities}
\NormalTok{p\_HVE          }\OtherTok{\textless{}{-}} \FloatTok{0.52}   \CommentTok{\# prevalence of HVE}
\NormalTok{p\_HVE\_comp     }\OtherTok{\textless{}{-}} \FloatTok{0.71}   \CommentTok{\# complications with untreated HVE}
\NormalTok{p\_OVE\_comp     }\OtherTok{\textless{}{-}} \FloatTok{0.01}   \CommentTok{\# complications with untreated OVE}
\NormalTok{p\_HVE\_comp\_tx  }\OtherTok{\textless{}{-}} \FloatTok{0.36}   \CommentTok{\# complications with treated HVE}
\NormalTok{p\_OVE\_comp\_tx  }\OtherTok{\textless{}{-}} \FloatTok{0.20}   \CommentTok{\# complications with treated OVE}
\NormalTok{p\_biopsy\_death }\OtherTok{\textless{}{-}} \FloatTok{0.005}  \CommentTok{\# probability of death due to biopsy}

\CommentTok{\# Costs}
\NormalTok{c\_VE           }\OtherTok{\textless{}{-}} \DecValTok{1200}   \CommentTok{\# cost of viral encephalitis care without complications}
\NormalTok{c\_VE\_comp      }\OtherTok{\textless{}{-}} \DecValTok{9000}   \CommentTok{\# cost of viral encephalitis care with complications}
\NormalTok{c\_tx           }\OtherTok{\textless{}{-}} \DecValTok{9500}   \CommentTok{\# cost of treatment}
\NormalTok{c\_biopsy       }\OtherTok{\textless{}{-}} \DecValTok{25000}  \CommentTok{\# cost of brain biopsy}
\NormalTok{c\_death\_biopsy }\OtherTok{\textless{}{-}} \DecValTok{0}      \CommentTok{\# cost of dying from brain biopsy}

\CommentTok{\# QALYs}
\NormalTok{q\_VE           }\OtherTok{\textless{}{-}} \DecValTok{20}     \CommentTok{\# remaining QALYs for those without VE{-}related complications}
\NormalTok{q\_VE\_comp      }\OtherTok{\textless{}{-}} \DecValTok{19}     \CommentTok{\# remaining QALYs for those with    VE{-}related complications}
\NormalTok{q\_loss\_biopsy  }\OtherTok{\textless{}{-}} \FloatTok{0.01}   \CommentTok{\# one{-}time  QALY loss due to brain biopsy}
\NormalTok{q\_death\_biopsy }\OtherTok{\textless{}{-}} \DecValTok{0}      \CommentTok{\# remaining QALYs for those who died during biopsy}
\end{Highlighting}
\end{Shaded}

\hypertarget{create-and-run-decision-tree-model}{%
\section{04 Create and run decision tree
model}\label{create-and-run-decision-tree-model}}

\hypertarget{create-vectors-of-weights-for-each-strategy}{%
\subsection{04.1 Create vectors of weights for each
strategy}\label{create-vectors-of-weights-for-each-strategy}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create vector of weights for each strategy }
\NormalTok{v\_w\_no\_tx  }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(    p\_HVE  }\SpecialCharTok{*}\NormalTok{      p\_HVE\_comp     ,  }\CommentTok{\# HVE, complications}
\NormalTok{                    p\_HVE  }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE\_comp)    ,  }\CommentTok{\# HVE, no complications}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE) }\SpecialCharTok{*}\NormalTok{      p\_OVE\_comp     ,  }\CommentTok{\# OVE, complications}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_OVE\_comp))      }\CommentTok{\# OVE, no complications}
  
\NormalTok{v\_w\_tx     }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(    p\_HVE  }\SpecialCharTok{*}\NormalTok{      p\_HVE\_comp\_tx  ,  }\CommentTok{\# HVE w/tx, complications}
\NormalTok{                    p\_HVE  }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE\_comp\_tx) ,  }\CommentTok{\# HVE w/tx, no complications}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE) }\SpecialCharTok{*}\NormalTok{      p\_OVE\_comp\_tx  ,  }\CommentTok{\# OVE w/tx, complications}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_OVE\_comp\_tx))   }\CommentTok{\# OVE w/tx, no complications}
  
\NormalTok{v\_w\_biopsy }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(    p\_biopsy\_death                   ,  }\CommentTok{\# biopsy death}
               \CommentTok{\# no biopsy death.,   HVE w/tx,        complications}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_biopsy\_death)   }\SpecialCharTok{*}\NormalTok{      p\_HVE  }\SpecialCharTok{*}\NormalTok{    p\_HVE\_comp\_tx  ,  }
               \CommentTok{\# no biopsy death.,   HVE w/tx,     no complications}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_biopsy\_death)   }\SpecialCharTok{*}\NormalTok{      p\_HVE  }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE\_comp\_tx) ,  }
               \CommentTok{\# no biopsy death.,        OVE,        complications}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_biopsy\_death)   }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE) }\SpecialCharTok{*}\NormalTok{      p\_OVE\_comp   ,  }
               \CommentTok{\# no biopsy death.,        OVE,     no complications}
\NormalTok{               (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_biopsy\_death)   }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_OVE\_comp))      }
\end{Highlighting}
\end{Shaded}

\#\#04.1.1 Extra code to demonstrate the use of ``clones'' The structure
of a decision tree consist of replication parts. To avoid coding the
same equation multiple times, we can make use of a function that
calculated that section. This is comparable, with what is in specialized
software called a clone. In de code chunk below, we show how we first
develop the clone function. And next how to use the function. Finally,
we demonstrate that we get identical results compared to what we had
before.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Develop a function to calculate the vector of weights for the decision tree}
\NormalTok{calculate\_hve\_complication }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p\_HVE, p\_HVE\_comp, p\_OVE\_comp)\{}
    \CommentTok{\# p\_HVE: the probability of having p\_HVE}
    \CommentTok{\# p\_HVE\_comp: the probability of getting a complication when you have an HVE infection}
    \CommentTok{\# p\_OVE\_comp: the probability of getting a complication when you have an OVE infection}
\NormalTok{       v\_weights }\OtherTok{\textless{}{-}}  \FunctionTok{c}\NormalTok{(    p\_HVE  }\SpecialCharTok{*}\NormalTok{      p\_HVE\_comp     ,  }\CommentTok{\# HVE, complications}
\NormalTok{                            p\_HVE  }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE\_comp)    ,  }\CommentTok{\# HVE, no complications}
\NormalTok{                       (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE) }\SpecialCharTok{*}\NormalTok{      p\_OVE\_comp     ,  }\CommentTok{\# OVE, complications}
\NormalTok{                       (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_HVE) }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_OVE\_comp))}
        \FunctionTok{return}\NormalTok{ (v\_weights) }\CommentTok{\# return the vector of weights}
\NormalTok{         \}}

\CommentTok{\# Create vector of weights for each strategy using the function }
\NormalTok{v\_w\_no\_tx\_clone  }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_hve\_complication}\NormalTok{(}\AttributeTok{p\_HVE =}\NormalTok{ p\_HVE, }\AttributeTok{p\_HVE\_comp =}\NormalTok{ p\_HVE\_comp, }\AttributeTok{p\_OVE\_comp =}\NormalTok{ p\_OVE\_comp)}
  
\NormalTok{v\_w\_tx\_clone     }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_hve\_complication}\NormalTok{(}\AttributeTok{p\_HVE =}\NormalTok{ p\_HVE, }\AttributeTok{p\_HVE\_comp =}\NormalTok{ p\_HVE\_comp\_tx, }\AttributeTok{p\_OVE\_comp =}\NormalTok{ p\_OVE\_comp\_tx)}

\NormalTok{v\_w\_biopsy\_clone }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(p\_biopsy\_death,  }
\NormalTok{                    (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ p\_biopsy\_death) }\SpecialCharTok{*}  \FunctionTok{calculate\_hve\_complication}\NormalTok{(}\AttributeTok{p\_HVE =}\NormalTok{ p\_HVE, }\AttributeTok{p\_HVE\_comp =}\NormalTok{ p\_HVE\_comp\_tx, }\AttributeTok{p\_OVE\_comp =}\NormalTok{ p\_OVE\_comp))}
                      
\CommentTok{\# Check if the clone gives identical results   }
\FunctionTok{all.equal}\NormalTok{(v\_w\_no\_tx\_clone, v\_w\_no\_tx)}
\FunctionTok{all.equal}\NormalTok{(v\_w\_tx\_clone, v\_w\_tx)}
\FunctionTok{all.equal}\NormalTok{(v\_w\_biopsy\_clone, v\_w\_biopsy)}
\end{Highlighting}
\end{Shaded}

\hypertarget{create-vectors-of-effects}{%
\subsection{0.4.2 Create vectors of
effects}\label{create-vectors-of-effects}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create vector of outcomes being complications for each strategy }
\NormalTok{v\_comp\_no\_tx  }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,          }\CommentTok{\# HVE, complications}
                   \DecValTok{0}\NormalTok{,          }\CommentTok{\# HVE, no complications}
                   \DecValTok{1}\NormalTok{,          }\CommentTok{\# OVE, complications}
                   \DecValTok{0}\NormalTok{)          }\CommentTok{\# OVE, no complications}
  
\NormalTok{v\_comp\_tx     }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,          }\CommentTok{\# HVE, complications}
                   \DecValTok{0}\NormalTok{,          }\CommentTok{\# HVE, no complications}
                   \DecValTok{1}\NormalTok{ ,         }\CommentTok{\# OVE, complications}
                   \DecValTok{0}\NormalTok{)          }\CommentTok{\# OVE, no complications}
  
\NormalTok{v\_comp\_biopsy }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,          }\CommentTok{\# biopsy complications}
                   \DecValTok{1}\NormalTok{,          }\CommentTok{\# no biopsy comp., HVE w/tx, complications }
                   \DecValTok{0}\NormalTok{,          }\CommentTok{\# no biopsy comp., HVE w/tx, no complications}
                   \DecValTok{1}\NormalTok{,          }\CommentTok{\# no biopsy comp., OVE, complications}
                   \DecValTok{0}\NormalTok{)          }\CommentTok{\# no biopsy comp., OVE, no complications}
  

\CommentTok{\# Create vector of outcomes (QALYs) for each strategy }
\NormalTok{v\_qaly\_no\_tx  }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(q\_VE\_comp ,          }\CommentTok{\# HVE, complications}
\NormalTok{                   q\_VE      ,          }\CommentTok{\# HVE, no complications}
\NormalTok{                   q\_VE\_comp ,          }\CommentTok{\# OVE, complications}
\NormalTok{                   q\_VE)                }\CommentTok{\# OVE, no complications}
  
\NormalTok{v\_qaly\_tx     }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(q\_VE\_comp ,          }\CommentTok{\# HVE, complications}
\NormalTok{                   q\_VE      ,          }\CommentTok{\# HVE, no complications}
\NormalTok{                   q\_VE\_comp ,          }\CommentTok{\# OVE, complications}
\NormalTok{                   q\_VE)                }\CommentTok{\# OVE, no complications}

\CommentTok{\# loss due to biopsy}
\NormalTok{v\_qaly\_biopsy }\OtherTok{\textless{}{-}}  \FunctionTok{c}\NormalTok{(q\_death\_biopsy }\SpecialCharTok{{-}}\NormalTok{ q\_loss\_biopsy,   }\CommentTok{\# biopsy complications}
\NormalTok{                    q\_VE\_comp      }\SpecialCharTok{{-}}\NormalTok{ q\_loss\_biopsy,   }\CommentTok{\# no biopsy comp., HVE w/tx, complications }
\NormalTok{                    q\_VE           }\SpecialCharTok{{-}}\NormalTok{ q\_loss\_biopsy,   }\CommentTok{\# no biopsy comp., HVE w/tx, no complications}
\NormalTok{                    q\_VE\_comp      }\SpecialCharTok{{-}}\NormalTok{ q\_loss\_biopsy,   }\CommentTok{\# no biopsy comp., OVE, complications}
\NormalTok{                    q\_VE           }\SpecialCharTok{{-}}\NormalTok{ q\_loss\_biopsy )  }\CommentTok{\# no biopsy comp., OVE, no complications}
\end{Highlighting}
\end{Shaded}

\hypertarget{create-vectors-of-costs}{%
\subsection{0.4.3 Create vectors of
costs}\label{create-vectors-of-costs}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create vector of costs for each strategy }
\CommentTok{\# cost of no treatment }
\NormalTok{v\_cost\_no\_tx  }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(c\_VE\_comp ,          }\CommentTok{\# HVE, complications}
\NormalTok{                   c\_VE      ,          }\CommentTok{\# HVE, no complications}
\NormalTok{                   c\_VE\_comp ,          }\CommentTok{\# OVE, complications}
\NormalTok{                   c\_VE)                }\CommentTok{\# OVE, no complications}

\CommentTok{\# cost of treatment}
\NormalTok{v\_cost\_tx     }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(c\_VE\_comp }\SpecialCharTok{+}\NormalTok{ c\_tx,    }\CommentTok{\# HVE, complications}
\NormalTok{                   c\_VE      }\SpecialCharTok{+}\NormalTok{ c\_tx,    }\CommentTok{\# HVE, no complications}
\NormalTok{                   c\_VE\_comp }\SpecialCharTok{+}\NormalTok{ c\_tx,    }\CommentTok{\# OVE, complications}
\NormalTok{                   c\_VE      }\SpecialCharTok{+}\NormalTok{ c\_tx)  }\CommentTok{\# OVE, no complications}

\CommentTok{\# cost of biopsy procedure}
\NormalTok{v\_cost\_biopsy }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(c\_death\_biopsy   }\SpecialCharTok{+}\NormalTok{ c\_biopsy,   }\CommentTok{\# cost of death (zero)}
\NormalTok{                   c\_VE\_comp }\SpecialCharTok{+}\NormalTok{ c\_tx }\SpecialCharTok{+}\NormalTok{ c\_biopsy,   }\CommentTok{\# no biopsy comp., HVE w/tx, complications }
\NormalTok{                   c\_VE      }\SpecialCharTok{+}\NormalTok{ c\_tx }\SpecialCharTok{+}\NormalTok{ c\_biopsy,   }\CommentTok{\# no biopsy comp., HVE w/tx, no complications}
\NormalTok{                   c\_VE\_comp        }\SpecialCharTok{+}\NormalTok{ c\_biopsy,   }\CommentTok{\# no biopsy comp., OVE, complications}
\NormalTok{                   c\_VE             }\SpecialCharTok{+}\NormalTok{ c\_biopsy )  }\CommentTok{\# no biopsy comp., OVE, no complications}
 
\DocumentationTok{\#\# STAR MATERIAL \#\#  }
\CommentTok{\# Extra funfact about coding}
\CommentTok{\# When you like to add a specific cost to all elements of a vector you can also add the costs before the vector. The vector for the cost of the biopsy for example could also be coded as follows:}

\CommentTok{\# cost of biopsy procedure}
\CommentTok{\#v\_cost\_biopsy \textless{}{-} c\_biopsy + }
\CommentTok{\#                    c(c\_death\_biopsy,     \# cost of death (zero)}
\CommentTok{\#                      c\_VE\_comp + c\_tx,   \# no biopsy comp., HVE w/tx, complications }
\CommentTok{\#                      c\_VE      + c\_tx,   \# no biopsy comp., HVE w/tx, no complications}
\CommentTok{\#                      c\_VE\_comp       ,   \# no biopsy comp., OVE, complications}
\CommentTok{\#                      c\_VE)               \# no biopsy comp., OVE, no complications}
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\hypertarget{calculate-the-expected-effects-complications-utilities-and-costs}{%
\subsection{0.4.4 Calculate the expected effects (complications,
utilities) and
costs}\label{calculate-the-expected-effects-complications-utilities-and-costs}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Calculate expected complications for each strategy }
\NormalTok{total\_comp\_no\_tx  }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_no\_tx  }\SpecialCharTok{\%*\%}\NormalTok{  v\_comp\_no\_tx      }
\NormalTok{total\_comp\_tx     }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_tx     }\SpecialCharTok{\%*\%}\NormalTok{  v\_comp\_tx}
\NormalTok{total\_comp\_biopsy }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_biopsy }\SpecialCharTok{\%*\%}\NormalTok{  v\_comp\_biopsy}
  
\CommentTok{\# Calculate total utilities for each strategy }
\NormalTok{total\_qaly\_no\_tx  }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_no\_tx  }\SpecialCharTok{\%*\%}\NormalTok{  v\_qaly\_no\_tx      }
\NormalTok{total\_qaly\_tx     }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_tx     }\SpecialCharTok{\%*\%}\NormalTok{  v\_qaly\_tx}
\NormalTok{total\_qaly\_biopsy }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_biopsy }\SpecialCharTok{\%*\%}\NormalTok{  v\_qaly\_biopsy}
  
\CommentTok{\# Calculate total costs for each strategy }
\NormalTok{total\_cost\_no\_tx  }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_no\_tx  }\SpecialCharTok{\%*\%}\NormalTok{  v\_cost\_no\_tx    }
\NormalTok{total\_cost\_tx     }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_tx     }\SpecialCharTok{\%*\%}\NormalTok{  v\_cost\_tx}
\NormalTok{total\_cost\_biopsy }\OtherTok{\textless{}{-}}\NormalTok{ v\_w\_biopsy }\SpecialCharTok{\%*\%}\NormalTok{  v\_cost\_biopsy}
  

\CommentTok{\# vector of expected complications }
\NormalTok{v\_total\_comp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(total\_comp\_no\_tx, total\_comp\_tx, total\_comp\_biopsy) }
\CommentTok{\# vector of total QALYs}
\NormalTok{v\_total\_qaly }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(total\_qaly\_no\_tx, total\_qaly\_tx, total\_qaly\_biopsy) }
\CommentTok{\# vector of total costs}
\NormalTok{v\_total\_cost }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(total\_cost\_no\_tx, total\_cost\_tx, total\_cost\_biopsy) }
\CommentTok{\# calculate vector of nmb}
\NormalTok{v\_nmb        }\OtherTok{\textless{}{-}}\NormalTok{ v\_total\_qaly }\SpecialCharTok{*}\NormalTok{ wtp }\SpecialCharTok{{-}}\NormalTok{ v\_total\_cost                      }
  
\CommentTok{\# Name outcomes}
\FunctionTok{names}\NormalTok{(v\_total\_comp) }\OtherTok{\textless{}{-}}\NormalTok{ v\_names\_str  }\CommentTok{\# names for the elements of the total comp vector}
\FunctionTok{names}\NormalTok{(v\_total\_qaly) }\OtherTok{\textless{}{-}}\NormalTok{ v\_names\_str  }\CommentTok{\# names for the elements of the total QALYs vector}
\FunctionTok{names}\NormalTok{(v\_total\_cost) }\OtherTok{\textless{}{-}}\NormalTok{ v\_names\_str  }\CommentTok{\# names for the elements of the total cost vector}
\FunctionTok{names}\NormalTok{(v\_nmb)        }\OtherTok{\textless{}{-}}\NormalTok{ v\_names\_str  }\CommentTok{\# names for the elements of the nmb vector}
  
\NormalTok{df\_output }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Strategy =}\NormalTok{  v\_names\_str,}
                        \AttributeTok{Cost     =}\NormalTok{  v\_total\_cost,}
                        \AttributeTok{Effect   =}\NormalTok{  v\_total\_qaly,}
                        \AttributeTok{Complications =}\NormalTok{ v\_total\_comp,}
                        \AttributeTok{NMB      =}\NormalTok{  v\_nmb)}

\CommentTok{\# model output}
\NormalTok{df\_output}
\end{Highlighting}
\end{Shaded}

\hypertarget{cost-effectiveness-analysis}{%
\section{05 Cost-Effectiveness
Analysis}\label{cost-effectiveness-analysis}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create the transition probability matrix for NO treatment}
\NormalTok{decision\_tree\_HVE\_cea  }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_icers}\NormalTok{(}\AttributeTok{cost       =}\NormalTok{ df\_output}\SpecialCharTok{$}\NormalTok{Cost,}
                                          \AttributeTok{effect     =}\NormalTok{ df\_output}\SpecialCharTok{$}\NormalTok{Effect,}
                                          \AttributeTok{strategies =}\NormalTok{ df\_output}\SpecialCharTok{$}\NormalTok{Strategy)}
\NormalTok{decision\_tree\_HVE\_cea}
\end{Highlighting}
\end{Shaded}

\hypertarget{plot-frontier-of-decision-tree}{%
\subsection{05.1 Plot frontier of Decision
Tree}\label{plot-frontier-of-decision-tree}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(decision\_tree\_HVE\_cea, }\AttributeTok{effect\_units =} \StringTok{"QALYs"}\NormalTok{, }\AttributeTok{label =} \StringTok{"all"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{acknowlegdement}{%
\section{Acknowlegdement}\label{acknowlegdement}}

For this work we made use of the template developed by the Decision
Analysis in R for Technologies in Health (DARTH) workgroup:
\url{http://darthworkgroup.com}.

The notation of our code is based on the following provided framework
and coding convention: Alarid-Escudero, F., Krijkamp, E.,
Pechlivanoglou, P. et al.~A Need for Change! A Coding Framework for
Improving Transparency in Decision Modeling. PharmacoEconomics 37,
1329--1339 (2019). \url{https://doi.org/10.1007/s40273-019-00837-x}.

\begin{itemize}
\item
  Alarid-Escudero F, Krijkamp EM, Enns EA, Yang A, Hunink MGM
  Pechlivanoglou P, Jalal H. An Introductory Tutorial on Cohort
  State-Transition Models in R Using a Cost-Effectiveness Analysis
  Example. Medical Decision Making, 2023; 43(1). (Epub).
  \url{https://doi.org/10.1177/0272989X221103163}
\item
  Alarid-Escudero F, Krijkamp EM, Enns EA, Yang A, Hunink MGM
  Pechlivanoglou P, Jalal H. A Tutorial on Time-Dependent Cohort
  State-Transition Models in R using a Cost-Effectiveness Analysis
  Example. Medical Decision Making, 2023; 43(1).
  \url{https://doi.org/10.1177/0272989X221121747}
\end{itemize}

Other work from DARTH can be found on the website:
\url{http://darthworkgroup.com/publications/}

\hypertarget{copyright-for-assignment-work}{%
\section{Copyright for assignment
work}\label{copyright-for-assignment-work}}

Copyright 2017, THE HOSPITAL FOR SICK CHILDREN AND THE COLLABORATING
INSTITUTIONS.All rights reserved in Canada, the United States and
worldwide. Copyright, trademarks, trade names and any and all associated
intellectual property are exclusively owned by THE HOSPITAL FOR Sick
CHILDREN and the collaborating institutions. These materials may be
used, reproduced, modified, distributed and adapted with proper
attribution.

\end{document}
