% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Intro to R for Decision Modeling},
  pdfauthor={SickKids and DARTH},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\title{Intro to R for Decision Modeling}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{Data Manipulation}
\author{SickKids and DARTH}
\date{11/2/2020}

\begin{document}
\maketitle

Change \texttt{eval} to \texttt{TRUE} if you want to knit this document.

This session presents the key commands needed to manipulate a dataset in
\texttt{R}. This worksheet is split into the following sections:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Data input and output
\item
  Subselecting data
\item
  Identifying and replacing data
\item
  Calculating useful statistics
\item
  Data manipulation with \texttt{dplyr}
\item
  Data manipulation with \texttt{pipe}
\end{enumerate}

Throughout the course, we will demonstrate code and leave some empty
\emph{code chunks} for you to fill in. We will also provide solutions
after the session.

Feel free to modify this document with your own comments and
clarifications.

\hypertarget{data-input-and-output}{%
\section{1. Data input and output}\label{data-input-and-output}}

\textbf{Input}

There are several ways of loading your data in \texttt{R}. A convenient
way of importing data into \texttt{R} is through tab-delimited text
(.txt) or comma separated (.csv) files. For this course, we have
provided a \texttt{.txt} file that contains the data we are going to be
using.

If you have a dataset to analyse in \texttt{R}, you can save the file as
a tab-delimited or as a comma separated file by opening it in Excel and
clicking \textbf{File -\textgreater{} Save As -\textgreater{} Save as
type} and selecting either the tab delimited or comma separated file
type.

Once you have saved your file, it is time to load it in \texttt{R}:

\begin{itemize}
\tightlist
\item
  \texttt{read.table()} is used to load \texttt{.txt} data
\item
  \texttt{read.csv()} is used to load \texttt{.csv} data.
\end{itemize}

The following example loads everything from a tab-delimited file called
\texttt{course\_data.txt} and creates an \texttt{R} object called
\texttt{mydata} that contains all the data from our file:

\texttt{mydata\ \textless{}-\ read.table(\textquotesingle{}C:/Users/UserName/Documents/course\_data.txt\textquotesingle{},\ header\ =\ TRUE)}

To ensure that \texttt{R} can find your file, you need to specify the
\emph{filepath} of your dataset
(C:/Users/UserName/Documents/course\_data.txt). The easiest way to find
this filepath in Windows is to navtigate to the file in the file
explorer, right click on the file, select Properties and copy the
\textbf{Location:} into \texttt{R} (\texttt{C:/Users/UserName/Documents}
in the above example). On a Mac, you can hold down the command button,
right click and choose the option \textbf{Copy File Path}.

\begin{itemize}
\item
  When you copy directly, you need to change the backslashes in the
  filepath to forward slashes!
\item
  You then need to add the name of the file and the file extension
  following another forward slash
\item
  You need to enter your \emph{filepath} between two quotation marks
  ("").
\end{itemize}

The code above contains the statement \texttt{header\ =\ TRUE} to
specify that the first row of the data contains the variable names for
your dataset. The data is also loaded and saved as an \emph{object} so
it can be used later for our data manipulation and analysis.

If your data file and the \texttt{R} file that loads the data file are
in the same folder, you can avoid typing your filepath by navigating to
the top bar of RStudio and click \textbf{Session -\textgreater{} Set
Working Directory -\textgreater{} To Source File Location}. This sets
the default filepath in \texttt{R}, often referred as the working
directory, to the filepath of your \texttt{R} or R Mardkown file that is
currently open.

\textbf{EXERCISE 1} Use the function \texttt{read.csv()} to read in
\texttt{framingham.csv}, the dataset provided for the exercises of this
workshop. Store the dataset as a variable named \texttt{data}. You can
use the \emph{code chunk} below.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"framingham.csv"}\NormalTok{, }\DataTypeTok{header =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Output}

When you are done with your statistical analysis and you want to export
the output of your work, you can use the \texttt{write.table()} function
to export the output as a tab delimited file or the \texttt{write.csv()}
function to export the output as a \texttt{.csv} file.

\texttt{write.table(mydata,\ file\ =\ \textquotesingle{}course\_data\_export.txt\textquotesingle{})}
exports the \texttt{R} object \texttt{mydata} back to a tab delimited
text file.

\texttt{write.csv(data,\ file\ =\ \textquotesingle{}framingham\_export.csv\textquotesingle{})}
exports the \texttt{R} object \texttt{mydata} back to a \texttt{.csv}
file.

To export to a specific file, you should use the entire \emph{filepath}
as described above. In the code above, the data would be saved to
\texttt{R}'s \emph{working directory}. This is default folder where
\texttt{R} will save all your results unless you specify the filepath.
You can find out the current working directory using:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{getwd}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "C:/Users/Alan Yang/Desktop/GitHub local/Course-Modularization/static/Course_Modularization/Intro to R/Worksheets/Solutions"
\end{verbatim}

It is possible to change the \emph{working directory}, using the command
\texttt{setwd()} and specifying the \emph{path} to a specific folder.
You can also set the working directory to your current file location
using \textbf{Session -\textgreater{} Set Working Directory
-\textgreater{} To Source File Location}.

\hypertarget{subselecting-data}{%
\section{2. Subselecting data}\label{subselecting-data}}

Most data manipulation in \texttt{R} involves comparing two values using
a \emph{relational operator}.

\texttt{R}'s relational operators compare two values and return either
TRUE or FALSE depending on the value and the comparison. The simplest
relational operator is the ``equal to'' operator (\texttt{==}) which
tests whether two values are the same.

The following table provides a list of \texttt{R}'s relational operators
and examples of possible logical expressions.

\begin{longtable}[]{@{}lll@{}}
\toprule
Relational Operators & Description & Example logical
expression\tabularnewline
\midrule
\endhead
\texttt{==} & equal to & \texttt{gender\ ==\ "male"}\tabularnewline
\texttt{!=} & not equal & \texttt{gender\ !=\ "male"}\tabularnewline
\texttt{\textless{}} & less than &
\texttt{age\ \textless{}\ 40}\tabularnewline
\texttt{\textgreater{}} & greater than &
\texttt{age\ \textgreater{}\ 10}\tabularnewline
\texttt{\textless{}=} & less than or equal to &
\texttt{age\ \textless{}=\ 40}\tabularnewline
\texttt{\textgreater{}=} & greater than or equal to &
\texttt{age\ \textgreater{}=\ 40}\tabularnewline
\texttt{\%in\%} & in & \texttt{age\ \%in\%\ c(30,31,32)}\tabularnewline
\bottomrule
\end{longtable}

\textbf{EXERCISE 2} Create two \texttt{R} objects called \texttt{gender}
and \texttt{age}. In the \emph{code chunk} below, run a few example
logical expressions from the table above.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gender <-}\StringTok{ "male"}
\NormalTok{gender <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"other"}\NormalTok{)}
\NormalTok{age <-}\StringTok{ }\DecValTok{80}

\CommentTok{# Your turn}
\NormalTok{gender }\OperatorTok{==}\StringTok{ "male"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gender }\OperatorTok{!=}\StringTok{ "male"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OperatorTok{<=}\StringTok{ }\DecValTok{40}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{30}\NormalTok{, }\DecValTok{31}\NormalTok{, }\DecValTok{32}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

When comparing a vector to a single item, the logical expression returns
TRUE or FALSE for each item in the vector depending on the logical
comparison.

\textbf{EXERCISE 3} Run the following \emph{code chunk} to understand
vectors and logical comparisons:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Vectors and Relational Operators}
\NormalTok{genders <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{)}
\NormalTok{genders }\OperatorTok{==}\StringTok{ "male"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE FALSE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{) }\OperatorTok{>}\StringTok{ }\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE  TRUE
\end{verbatim}

Comparing vectors of the same length compares the \(i^{th}\) element in
the first vector to the \(i^{th}\) element in the second vector.

\textbf{EXERCISE 4} Run the following \emph{code chunk} to understand
vectors and logical comparisons:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Vectors and Relational Operators}
\NormalTok{genders }\OperatorTok{==}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Bridge"}\NormalTok{, }\StringTok{"Building"}\NormalTok{, }\StringTok{"male"}\NormalTok{, }\StringTok{"Road"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE FALSE
\end{verbatim}

We can combine the relational operators with \texttt{R}`s logical
operators of 'and' (\texttt{\&}) and `or' (\texttt{\textbar{}}) to
create more complex logical expressions.

\begin{itemize}
\item
  \texttt{\&} returns TRUE when both expressions on the left and right
  side of the ampersand return TRUE.
\item
  \texttt{\textbar{}} returns TRUE when either of the expressions on the
  left or right side of the \texttt{\textbar{}} returns TRUE.
\end{itemize}

\textbf{EXERCISE 5} Use to code in the following \emph{code chunk} to
understand \texttt{\&} and \texttt{\textbar{}}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\OtherTok{TRUE} \OperatorTok{|}\StringTok{ }\OtherTok{FALSE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{TRUE} \OperatorTok{&}\StringTok{ }\OtherTok{FALSE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{TRUE} \OperatorTok{|}\StringTok{ }\OtherTok{TRUE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{FALSE} \OperatorTok{&}\StringTok{ }\OtherTok{FALSE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\textbf{Subselecting rows or columns in a dataset}

There are many cases where you will need to select specific rows or
columns of your data after you load it in \texttt{R}, for example:

\begin{itemize}
\item
  You may import more variables into \texttt{R} than you would like to
  use in the analysis.
\item
  Subjects may need to be excluded from further analysis, e.g.~for
  incomplete data or outlier testing.
\item
  You might want to stratify your data into two or more categories
  before proceeding with the analysis.
\end{itemize}

This is called subsetting or subselecting and can be easily performed in
\texttt{R}.

If you want to create a new dataset \texttt{data\_new} that only
contains the first five columns of the Framingham dataset, we type the
following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data_new <-}\StringTok{ }\NormalTok{data[ , }\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{]}
\KeywordTok{head}\NormalTok{(data_new)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX TOTCHOL AGE SYSBP
## 1   2448   1     209  52   121
## 2   6238   2     237  58   108
## 3  11252   2      NA  58   155
## 4  11263   2     220  55   180
## 5  12806   2     320  57   110
## 6  14367   1     280  64   168
\end{verbatim}

Remember, the Framingham dataset is stored in an \emph{object} called
\texttt{data} that we loaded earlier.

In \texttt{R}, the statement \texttt{1:5} is read as `from 1 to 5' and
specifies that we should select columns, 1, 2, 3, 4, 5.

\textbf{EXERCISE 6} Create a new dataset named \texttt{data\_new} that
only contains the first 10 columns of the Framingham dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data_new <-}\StringTok{ }\NormalTok{data[, }\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{]}
\KeywordTok{head}\NormalTok{(data_new)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX TOTCHOL AGE SYSBP DIABP CURSMOKE CIGPDAY   BMI DIABETES
## 1   2448   1     209  52   121    66        0       0    NA        0
## 2   6238   2     237  58   108    66        0       0 28.50        0
## 3  11252   2      NA  58   155    90        1      30 24.61        0
## 4  11263   2     220  55   180   106        0       0 31.17        1
## 5  12806   2     320  57   110    46        1      30 22.02        0
## 6  14367   1     280  64   168   100        0       0 25.72        0
\end{verbatim}

The \texttt{data} \emph{object} is stored by \texttt{R} as a data frame.
A data frame has columns that contains the different variables and rows
that contain information about each subject. In the above code, we
selected a specific subset of the \emph{columns}. We can also select a
specific subset of \emph{rows} by placing numbers before the comma,
e.g.~

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data1 <-}\StringTok{ }\NormalTok{data[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{]}
\KeywordTok{head}\NormalTok{(data1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX TOTCHOL AGE SYSBP
## 1   2448   1     209  52   121
## 2   6238   2     237  58   108
## 3  11252   2      NA  58   155
## 4  11263   2     220  55   180
## 5  12806   2     320  57   110
\end{verbatim}

Subselects the first five columns from the first five subjects only and
stores them in a variable called \texttt{data1}.

You can also subselect columns and rows by their name, e.g.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data2 <-}\StringTok{ }\NormalTok{data[, }\KeywordTok{c}\NormalTok{(}\StringTok{"SEX"}\NormalTok{, }\StringTok{"AGE"}\NormalTok{, }\StringTok{"BMI"}\NormalTok{, }\StringTok{"HEARTRTE"}\NormalTok{, }\StringTok{"GLUCOSE"}\NormalTok{)]}
\KeywordTok{head}\NormalTok{(data2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   SEX AGE   BMI HEARTRTE GLUCOSE
## 1   1  52    NA       69      92
## 2   2  58 28.50       80      71
## 3   2  58 24.61       74      NA
## 4   2  55 31.17       86      81
## 5   2  57 22.02       75      87
## 6   1  64 25.72       92      82
\end{verbatim}

\textbf{EXERCISE 7} Create a new dataset named \texttt{data2\_new} that
contains the first 10 subjects and the subject ID, sex, age, bmi, heart
rate and glucose columns from the Framingham dataset. Then, take a quick
glance of the new dataset.

\begin{itemize}
\item
  You can see the names of the columns of a dataset using the command
  \texttt{colnames(data)}, you can also look at the data dictionary.
\item
  The function \texttt{head()} takes a dataset and returns the first 6
  rows and all columns. It is a very useful function to get a quick
  glace of your data.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data2_new <-}\StringTok{ }\NormalTok{data[}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{, }
                  \KeywordTok{c}\NormalTok{(}\StringTok{"RANDID"}\NormalTok{, }\StringTok{"SEX"}\NormalTok{, }\StringTok{"AGE"}\NormalTok{, }\StringTok{"BMI"}\NormalTok{, }
                    \StringTok{"HEARTRTE"}\NormalTok{, }\StringTok{"GLUCOSE"}\NormalTok{)]}
\KeywordTok{head}\NormalTok{(data2_new)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX AGE   BMI HEARTRTE GLUCOSE
## 1   2448   1  52    NA       69      92
## 2   6238   2  58 28.50       80      71
## 3  11252   2  58 24.61       74      NA
## 4  11263   2  55 31.17       86      81
## 5  12806   2  57 22.02       75      87
## 6  14367   1  64 25.72       92      82
\end{verbatim}

It is also possible to subset with logical expressions and select the
rows or columns of a data frame that fulfils a certain condition. For
example, we can extract and present all rows of our \texttt{data} where
the participant is older than 30.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(data[data}\OperatorTok{$}\NormalTok{AGE }\OperatorTok{>}\StringTok{ }\DecValTok{30}\NormalTok{,])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX TOTCHOL AGE SYSBP DIABP CURSMOKE CIGPDAY   BMI DIABETES BPMEDS
## 1   2448   1     209  52   121    66        0       0    NA        0      0
## 2   6238   2     237  58   108    66        0       0 28.50        0      0
## 3  11252   2      NA  58   155    90        1      30 24.61        0      0
## 4  11263   2     220  55   180   106        0       0 31.17        1      1
## 5  12806   2     320  57   110    46        1      30 22.02        0      0
## 6  14367   1     280  64   168   100        0       0 25.72        0      0
##   HEARTRTE GLUCOSE educ PREVCHD PREVAP PREVMI PREVSTRK PREVHYP TIME PERIOD HDLC
## 1       69      92    4       0      0      0        0       0 4628      3   31
## 2       80      71    2       0      0      0        0       0 4344      3   54
## 3       74      NA    3       0      0      0        0       1 4285      3   NA
## 4       86      81    2       0      0      0        0       1 4351      3   46
## 5       75      87    2       0      0      0        0       0 4289      3   34
## 6       92      82    1       0      0      0        0       1 4438      3   44
##   LDLC DEATH ANGINA HOSPMI MI_FCHD ANYCHD STROKE CVD HYPERTEN TIMEAP TIMEMI
## 1  178     0      0      1       1      1      0   1        0   8766   6438
## 2  141     0      0      0       0      0      0   0        0   8766   8766
## 3   NA     0      0      0       0      0      0   0        1   8766   8766
## 4  135     0      0      0       1      1      0   1        1   8766   8766
## 5  286     0      0      0       0      0      0   0        1   8766   8766
## 6  236     0      0      0       0      0      0   0        1   8766   8766
##   TIMEMIFC TIMECHD TIMESTRK TIMECVD TIMEDTH TIMEHYP
## 1     6438    6438     8766    6438    8766    8766
## 2     8766    8766     8766    8766    8766    8766
## 3     8766    8766     8766    8766    8766    4285
## 4     5719    5719     8766    5719    8766       0
## 5     8766    8766     8766    8766    8766    8679
## 6     8766    8766     8766    8766    8766       0
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{data\$AGE} is shorthand in \texttt{R} for
  \texttt{data{[},"AGE"{]}}. In general, you can use the \$ sign
  followed by the name of the variable to select a specific column of a
  data set. You can only use this shorthand to select a single column
  from a data frame.
\end{itemize}

\textbf{EXERCISE 8} Create a new dataset called \texttt{data3} that
contains all the subject ID, sex, age, BMI and heart rates for the
subjects whose heart rate is greater than 100. Display the first 6 rows.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data3 <-}\StringTok{ }\NormalTok{data[data}\OperatorTok{$}\NormalTok{HEARTRTE }\OperatorTok{>}\StringTok{ }\DecValTok{100}\NormalTok{, }
              \KeywordTok{c}\NormalTok{(}\StringTok{"RANDID"}\NormalTok{, }\StringTok{"SEX"}\NormalTok{, }\StringTok{"AGE"}\NormalTok{, }\StringTok{"BMI"}\NormalTok{, }\StringTok{"HEARTRTE"}\NormalTok{)]}
\KeywordTok{head}\NormalTok{(data3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     RANDID SEX AGE   BMI HEARTRTE
## 13   36459   1  53 26.43      105
## 50  160953   2  75 25.31      110
## 51  162207   2  74 31.45      120
## 64  199546   2  73 28.69      105
## 96  290692   2  59 21.10      104
## 110 359422   2  69 33.11      110
\end{verbatim}

\hypertarget{identifying-and-replacing-data}{%
\section{3. Identifying and replacing
data}\label{identifying-and-replacing-data}}

\textbf{Identifying missing values}

Datasets are hardly ever complete. Missing values in data are very
common and problematic in analysis procedures as they can cause issues
with the analysis. It is useful to identify, and potentially, replace or
remove missing values from a dataset. \texttt{R} assigns the value
\texttt{NA} (Not Available) in every cell of a data frame that is
missing.

To identify missing values, you can use the function \texttt{is.na()}.
This function returns a logical vector or matrix (depending on the
input) with the value TRUE where there is an NA and FALSE where the data
are complete. For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\DecValTok{9}\NormalTok{, }\OtherTok{NA}\NormalTok{)}
\KeywordTok{is.na}\NormalTok{(b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE FALSE  TRUE FALSE  TRUE
\end{verbatim}

If you want to subselect subjects without missing data for heart rate.
You could use the function \texttt{is.na()} to identify the subjects
that have no missing values in their heart rate variable and exclude
them:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{No_missing_heartrate_data <-}\StringTok{ }\NormalTok{data[}\KeywordTok{is.na}\NormalTok{(data}\OperatorTok{$}\NormalTok{HEARTRTE) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 9} Subselect subjects without any glucose information.
You do not need to store the new dataset, just display the first 6
subjects and the \texttt{RANDID} and \texttt{GLUCOSE} columns.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\KeywordTok{head}\NormalTok{(data[}\KeywordTok{is.na}\NormalTok{(data}\OperatorTok{$}\NormalTok{GLUCOSE) }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{'RANDID'}\NormalTok{, }\StringTok{'GLUCOSE'}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    RANDID GLUCOSE
## 3   11252      NA
## 15  43522      NA
## 26  77492      NA
## 29  83398      NA
## 33  95148      NA
## 42 125413      NA
\end{verbatim}

\texttt{R} also has a function \texttt{na.omit()}, that removes all
observations with missing values in any of the columns.

\textbf{EXERCISE 10} Calculate the number of observations in our data
that does not have any missing values for the heart rate and glucose
columns. The \texttt{nrow()} and \texttt{ncol()} functions give the
total number of rows and columns of a dataset, respectively, when used
on a dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\CommentTok{# 1st way, using & and is.na()}
\NormalTok{data3 <-}\StringTok{ }\NormalTok{data[(}\KeywordTok{is.na}\NormalTok{(data}\OperatorTok{$}\NormalTok{HEARTRTE) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) }\OperatorTok{&}\StringTok{ }
\StringTok{                }\NormalTok{(}\KeywordTok{is.na}\NormalTok{(data}\OperatorTok{$}\NormalTok{GLUCOSE) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{), }
              \KeywordTok{c}\NormalTok{(}\StringTok{"HEARTRTE"}\NormalTok{, }\StringTok{"GLUCOSE"}\NormalTok{)]}
\KeywordTok{nrow}\NormalTok{(data3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2701
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 2nd way, using na.omit()}
\CommentTok{# na.omit function omits NAs from your dataset.}
\NormalTok{data_no_missing <-}\StringTok{ }\NormalTok{data[, }\KeywordTok{c}\NormalTok{(}\StringTok{'HEARTRTE'}\NormalTok{, }\StringTok{'GLUCOSE'}\NormalTok{)]}
\NormalTok{data_no_missing <-}\StringTok{ }\KeywordTok{na.omit}\NormalTok{(data_no_missing)}
\KeywordTok{nrow}\NormalTok{(data_no_missing)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2701
\end{verbatim}

\textbf{Identifying and replacing values in a dataset}

It is also possible to find and replace values in a dataset. For
example, we may want to create a new variable named \texttt{SEX\_char}
for the existing Framingham dataset. We want our new varible to be equal
to ``male'' when \texttt{SEX} is equal to 1 and ``female'' when
\texttt{SEX} equals 2. This is achieved using the following commands.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Creating a new variable}
\NormalTok{data}\OperatorTok{$}\NormalTok{SEX_char[data}\OperatorTok{$}\NormalTok{SEX }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{] <-}\StringTok{ 'male'}
\NormalTok{data}\OperatorTok{$}\NormalTok{SEX_char[data}\OperatorTok{$}\NormalTok{SEX }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{] <-}\StringTok{ 'female'}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 11} Construct a new variable named
\texttt{DIABETES\_char} within the Framingham dataset. In this variable,
all \texttt{DIABETES} elements equal to `0' should be given the
character string `Not a diabetic', and all elements equal to `1' should
be given the character string `Diabetic'.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data}\OperatorTok{$}\NormalTok{DIABETES_char[data}\OperatorTok{$}\NormalTok{DIABETES }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{] <-}\StringTok{ 'Not a diabetic'}
\NormalTok{data}\OperatorTok{$}\NormalTok{DIABETES_char[data}\OperatorTok{$}\NormalTok{DIABETES }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{] <-}\StringTok{ 'Diabetic'}
\end{Highlighting}
\end{Shaded}

You can also replace \texttt{NA} values with a numerical value. For
example, if all subjects with missing values are not diabetic, we can
correct this using the \texttt{R} code below

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Updated missingness}
\NormalTok{data}\OperatorTok{$}\NormalTok{DIABETES[}\KeywordTok{is.na}\NormalTok{(data}\OperatorTok{$}\NormalTok{DIABETES)] <-}\StringTok{ }\DecValTok{0}
\end{Highlighting}
\end{Shaded}

\textbf{Factors}

If some of the predictors have a categorical structure, we need to
ensure that \texttt{R} recognizes these as \emph{factors} as opposed to
numerical values. When we create \emph{factors}, we can also decide
which category is going to be used as the reference level.

\begin{itemize}
\item
  The function \texttt{factor()} turns a character variable into a
  factor variable.
\item
  The function \texttt{levels()} shows the categories, or \emph{levels},
  of a factor, in ascending order. The first level by default is the
  reference category when inserted into a regression model.
\end{itemize}

The following code makes \texttt{SEX} into a factor variable and display
the level.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}\OperatorTok{$}\NormalTok{SEX_char <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(data}\OperatorTok{$}\NormalTok{SEX_char)}
\KeywordTok{levels}\NormalTok{(data}\OperatorTok{$}\NormalTok{SEX_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "female" "male"
\end{verbatim}

\hypertarget{calculating-useful-statistics}{%
\section{4. Calculating useful
statistics}\label{calculating-useful-statistics}}

Assume you want to calculate the arithmetic mean and variance of the age
of your Framingham sample. You can easily do this by typing:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{(data1}\OperatorTok{$}\NormalTok{AGE)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 56
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{var}\NormalTok{(data1}\OperatorTok{$}\NormalTok{AGE)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6.5
\end{verbatim}

\textbf{EXERCISE 12} Calculate the mean and variance of BMI. Hint: most
statistical functions in \texttt{R} does not automatically exclude
missing values. If your variable has missing values, you need to specify
\texttt{na.rm\ =\ TRUE} or the result will always be \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\KeywordTok{mean}\NormalTok{(data}\OperatorTok{$}\NormalTok{BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 25.89478
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{var}\NormalTok{(data}\OperatorTok{$}\NormalTok{BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 16.65175
\end{verbatim}

There are several functions in \texttt{R} to compute different
descriptive statistics:

\begin{itemize}
\tightlist
\item
  \texttt{median()}: Calculates the median for the data
\item
  \texttt{min()}: Finds the minimum value for the data
\item
  \texttt{max()}: Finds the maximum value for the data
\item
  \texttt{sd()}: Calculates the standard deviation of the data
\item
  \texttt{quantile()}: Find data quantiles, by default the min, 25\%
  quantile, median, 75\% quantile and the maximum.
\end{itemize}

\texttt{summary()} is a useful function that produces various common
statistics in one go.

\textbf{EXERCISE 13} Call the \texttt{summary()} function on BMI and see
what types of statistics it gives.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\KeywordTok{summary}\NormalTok{(data}\OperatorTok{$}\NormalTok{BMI)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##   14.43   23.19   25.46   25.89   28.06   56.80      17
\end{verbatim}

We can use subsetting to calculate summary statistics for different
subgroups in our data. For example, we can compute the mean and variance
of age for men and women:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\KeywordTok{mean}\NormalTok{(data}\OperatorTok{$}\NormalTok{AGE[data}\OperatorTok{$}\NormalTok{SEX_char }\OperatorTok{==}\StringTok{ "male"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 60.34895
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{(data}\OperatorTok{$}\NormalTok{AGE[data}\OperatorTok{$}\NormalTok{SEX_char }\OperatorTok{==}\StringTok{ "female"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 60.8694
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{var}\NormalTok{(data}\OperatorTok{$}\NormalTok{AGE[data}\OperatorTok{$}\NormalTok{SEX_char }\OperatorTok{==}\StringTok{ "male"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 67.10037
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{var}\NormalTok{(data}\OperatorTok{$}\NormalTok{AGE[data}\OperatorTok{$}\NormalTok{SEX_char }\OperatorTok{==}\StringTok{ "female"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 70.04107
\end{verbatim}

\textbf{EXERCISE 14} Calculate the median and max of BMI for those who
are over 60 years old with a heart rate of over 100 beats/min.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{BMI_short <-}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{BMI[data1}\OperatorTok{$}\NormalTok{AGE }\OperatorTok{>}\StringTok{ }\DecValTok{60} \OperatorTok{&}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{HEARTRTE }\OperatorTok{>}\StringTok{ }\DecValTok{100}\NormalTok{]}
\KeywordTok{median}\NormalTok{(BMI_short, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{max}\NormalTok{(BMI_short, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -Inf
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(BMI_short)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 
\end{verbatim}

We can calculate the correlation between two or more variables using the
\texttt{cor()} function. There are three methods for calculating
correlation supported within \texttt{R} (Pearson, Kendal or Spearman
method), more information can be found by running \texttt{?cor}.

To calculate the Pearson correlation coefficient for BMI and systolic
blood pressure, we use:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(data}\OperatorTok{$}\NormalTok{AGE, data}\OperatorTok{$}\NormalTok{SYSBP)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.3420412
\end{verbatim}

If you want to calculate the correlations across several continuous
variables in your dataset, the \texttt{cor()} function can be called on
a data frame.

\textbf{EXERCISE 15} Create a new dataset that only contains age, BMI,
heart rate, glucose and systolic blood pressure. Use the \texttt{cor()}
function to find the pairwise correlations between all these variables.

Note that \texttt{cor()} does not automatically exclude missing values.
This can be achieved using the option
\texttt{use\ =\ "pairwise.complete.obs"} in the \texttt{cor()} function.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{cont_vars <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(data, AGE, BMI, HEARTRTE, GLUCOSE, SYSBP)}
\KeywordTok{cor}\NormalTok{(cont_vars, }\DataTypeTok{use =} \StringTok{"pairwise.complete.obs"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  AGE         BMI   HEARTRTE    GLUCOSE     SYSBP
## AGE       1.00000000 -0.02845066 0.03236608 0.09174635 0.3420412
## BMI      -0.02845066  1.00000000 0.05577924 0.06968376 0.2177946
## HEARTRTE  0.03236608  0.05577924 1.00000000 0.16130869 0.1593737
## GLUCOSE   0.09174635  0.06968376 0.16130869 1.00000000 0.1455470
## SYSBP     0.34204125  0.21779458 0.15937365 0.14554702 1.0000000
\end{verbatim}

\hypertarget{data-manipulation-with-dplyr}{%
\section{\texorpdfstring{5. Data manipulation with
\texttt{dplyr}}{5. Data manipulation with dplyr}}\label{data-manipulation-with-dplyr}}

When manipulating larger datasets the \texttt{dplyr} package provides a
set of functions that are easier to read, modify, and computationally
faster than the code we showed above.

We will be focusing on these five functions:

\begin{itemize}
\tightlist
\item
  \texttt{filter()} for selecting rows based on observational
  characteristics
\item
  \texttt{select()} for selecting variables based on their names
\item
  \texttt{mutate()} for creating new variables
\item
  \texttt{summarise()} for summarizing data
\item
  \texttt{group\_by()} for sub-population analysis
\end{itemize}

Let's start by loading the \texttt{dplyr} package that you installed in
the previous session.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

An important thing to note is that all \texttt{dplyr} functions use the
dataset (e.g.~\texttt{data}) as the first argument.

The function \texttt{filter()} returns a new dataset with all the
observations that satisfy a set of logical expressions.

For example, we can select all the male participants (represented as 1)
in the Framingham dataset who are under 40 years old and have a heart
rate of over 100 beats/min:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(}\KeywordTok{filter}\NormalTok{(data, SEX }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, AGE }\OperatorTok{>}\StringTok{ }\DecValTok{40}\NormalTok{, HEARTRTE }\OperatorTok{>}\StringTok{ }\DecValTok{100}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    RANDID SEX TOTCHOL AGE SYSBP DIABP CURSMOKE CIGPDAY   BMI DIABETES BPMEDS
## 1   36459   1     162  53 152.5   101        0       0 26.43        0      0
## 2  575116   1     209  58 121.0    77        0       0 28.07        0      1
## 3  638453   1     250  53 160.0    98        1      40 22.48        0      1
## 4  984473   1      NA  55 137.0    89        1      70 29.00        0      1
## 5 1044236   1     214  62 181.0    90        0       0 31.51        1      0
## 6 2067160   1     141  75 152.0   102        1      25 26.09        1     NA
##   HEARTRTE GLUCOSE educ PREVCHD PREVAP PREVMI PREVSTRK PREVHYP TIME PERIOD HDLC
## 1      105      78    2       0      0      0        0       1 4411      3   31
## 2      108     131    4       0      0      0        0       1 4367      3   41
## 3      110      92    2       0      0      0        0       1 4423      3   60
## 4      110      84    2       0      0      0        0       1 4393      3   NA
## 5      102     151    1       0      0      0        0       1 4359      3   51
## 6      102     172    2       0      0      0        0       1 4214      3   27
##   LDLC DEATH ANGINA HOSPMI MI_FCHD ANYCHD STROKE CVD HYPERTEN TIMEAP TIMEMI
## 1   91     0      0      0       0      0      0   0        1   8766   8766
## 2  168     0      1      0       0      1      1   1        1   6236   8766
## 3  190     0      0      0       0      0      0   0        1   8766   8766
## 4   NA     1      0      0       1      1      0   1        1   4653   4653
## 5  163     0      0      0       0      0      0   0        1   8766   8766
## 6   80     1      0      0       0      1      0   1        1   6819   6819
##   TIMEMIFC TIMECHD TIMESTRK TIMECVD TIMEDTH TIMEHYP SEX_char  DIABETES_char
## 1     8766    8766     8766    8766    8766    1469     male Not a diabetic
## 2     8766    6236     8313    6236    8766       0     male Not a diabetic
## 3     8766    8766     8766    8766    8766     735     male Not a diabetic
## 4     4653    4653     4653    4653    4653       0     male Not a diabetic
## 5     8766    8766     8766    8766    8766       0     male       Diabetic
## 6     6819    6289     6819    6289    6819    1456     male       Diabetic
\end{verbatim}

\textbf{EXERCISE 16} Select all female participants (represented as a 2
in the \texttt{SEX} variable) in the Framingham dataset who are over 50
years old and have a glucose measurement of over 100 mg/dL. Only display
the first 6 observations.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\KeywordTok{head}\NormalTok{(}\KeywordTok{filter}\NormalTok{(data, SEX }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{, AGE }\OperatorTok{>}\StringTok{ }\DecValTok{50}\NormalTok{, GLUCOSE }\OperatorTok{>}\StringTok{ }\DecValTok{100}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX TOTCHOL AGE SYSBP DIABP CURSMOKE CIGPDAY   BMI DIABETES BPMEDS
## 1  23727   2     159  53   124    78        0       0 26.62        0      0
## 2  40435   2     226  54   126    75        1      40 21.59        0      0
## 3  43770   2     283  64   159    69        0       0 32.93        1      0
## 4  94510   2     293  53   127    77        1       3 25.68        0      0
## 5  97026   2     206  61   112    80        0       0 21.96        0     NA
## 6 112469   2     224  74   125    68        0       0 27.35        0      0
##   HEARTRTE GLUCOSE educ PREVCHD PREVAP PREVMI PREVSTRK PREVHYP TIME PERIOD HDLC
## 1       68     135    3       0      0      0        0       1 4503      3   53
## 2       85     102    2       0      0      0        0       0 4372      3   84
## 3       70     230    1       0      0      0        0       1 4375      3   45
## 4       90     115    2       0      0      0        0       0 4366      3   52
## 5       63     138    2       0      0      0        0       0 4263      3   84
## 6       80     109    1       0      0      0        0       1 4332      3   35
##   LDLC DEATH ANGINA HOSPMI MI_FCHD ANYCHD STROKE CVD HYPERTEN TIMEAP TIMEMI
## 1  106     1      0      0       0      0      0   0        1   5592   5592
## 2  142     0      0      0       0      0      0   0        1   8766   8766
## 3  238     1      0      1       1      1      0   1        1   6410   6384
## 4  241     0      0      0       0      0      0   0        0   8766   8766
## 5  102     0      0      0       0      0      0   0        0   8766   8766
## 6  189     0      0      0       0      0      0   0        1   8766   8766
##   TIMEMIFC TIMECHD TIMESTRK TIMECVD TIMEDTH TIMEHYP SEX_char  DIABETES_char
## 1     5592    5592     5592    5592    5592       0   female Not a diabetic
## 2     8766    8766     8766    8766    8766    5933   female Not a diabetic
## 3     6384    6384     6410    6384    6410     723   female       Diabetic
## 4     8766    8766     8766    8766    8766    8766   female Not a diabetic
## 5     8766    8766     8766    8766    8766    8766   female Not a diabetic
## 6     8766    8766     8766    8766    8766    1463   female Not a diabetic
\end{verbatim}

\texttt{select()} allows you to select variables from a dataset based on
the variable names. To select \texttt{SEX}, \texttt{AGE}, \texttt{BMI}
\texttt{HEARTRTE} and \texttt{GLUCCOSE} from the Framingham dataset, the
following command is used:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(}\KeywordTok{select}\NormalTok{(data, SEX, AGE, BMI, HEARTRTE, GLUCOSE))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   SEX AGE   BMI HEARTRTE GLUCOSE
## 1   1  52    NA       69      92
## 2   2  58 28.50       80      71
## 3   2  58 24.61       74      NA
## 4   2  55 31.17       86      81
## 5   2  57 22.02       75      87
## 6   1  64 25.72       92      82
\end{verbatim}

It is also possible to remove variables from a dataset by including
\texttt{-}. To remove our newly created \texttt{DIABETES} variable from
\texttt{data} you can type:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(}\KeywordTok{select}\NormalTok{(data, }\OperatorTok{-}\NormalTok{DIABETES))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX TOTCHOL AGE SYSBP DIABP CURSMOKE CIGPDAY   BMI BPMEDS HEARTRTE
## 1   2448   1     209  52   121    66        0       0    NA      0       69
## 2   6238   2     237  58   108    66        0       0 28.50      0       80
## 3  11252   2      NA  58   155    90        1      30 24.61      0       74
## 4  11263   2     220  55   180   106        0       0 31.17      1       86
## 5  12806   2     320  57   110    46        1      30 22.02      0       75
## 6  14367   1     280  64   168   100        0       0 25.72      0       92
##   GLUCOSE educ PREVCHD PREVAP PREVMI PREVSTRK PREVHYP TIME PERIOD HDLC LDLC
## 1      92    4       0      0      0        0       0 4628      3   31  178
## 2      71    2       0      0      0        0       0 4344      3   54  141
## 3      NA    3       0      0      0        0       1 4285      3   NA   NA
## 4      81    2       0      0      0        0       1 4351      3   46  135
## 5      87    2       0      0      0        0       0 4289      3   34  286
## 6      82    1       0      0      0        0       1 4438      3   44  236
##   DEATH ANGINA HOSPMI MI_FCHD ANYCHD STROKE CVD HYPERTEN TIMEAP TIMEMI TIMEMIFC
## 1     0      0      1       1      1      0   1        0   8766   6438     6438
## 2     0      0      0       0      0      0   0        0   8766   8766     8766
## 3     0      0      0       0      0      0   0        1   8766   8766     8766
## 4     0      0      0       1      1      0   1        1   8766   8766     5719
## 5     0      0      0       0      0      0   0        1   8766   8766     8766
## 6     0      0      0       0      0      0   0        1   8766   8766     8766
##   TIMECHD TIMESTRK TIMECVD TIMEDTH TIMEHYP SEX_char  DIABETES_char
## 1    6438     8766    6438    8766    8766     male Not a diabetic
## 2    8766     8766    8766    8766    8766   female Not a diabetic
## 3    8766     8766    8766    8766    4285   female Not a diabetic
## 4    5719     8766    5719    8766       0   female       Diabetic
## 5    8766     8766    8766    8766    8679   female Not a diabetic
## 6    8766     8766    8766    8766       0     male Not a diabetic
\end{verbatim}

Be careful, once you remove a variable from a dataset you cannot recover
it. Therefore, you should usually make a copy of the original dataset
and manipulate the copy.

\texttt{mutate()} creates new variables in a dataset. The following
command creates a new variable that is the logarithmic transformation of
\texttt{AGE}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(}\KeywordTok{mutate}\NormalTok{(data, }\DataTypeTok{log_AGE =} \KeywordTok{log}\NormalTok{(AGE)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX TOTCHOL AGE SYSBP DIABP CURSMOKE CIGPDAY   BMI DIABETES BPMEDS
## 1   2448   1     209  52   121    66        0       0    NA        0      0
## 2   6238   2     237  58   108    66        0       0 28.50        0      0
## 3  11252   2      NA  58   155    90        1      30 24.61        0      0
## 4  11263   2     220  55   180   106        0       0 31.17        1      1
## 5  12806   2     320  57   110    46        1      30 22.02        0      0
## 6  14367   1     280  64   168   100        0       0 25.72        0      0
##   HEARTRTE GLUCOSE educ PREVCHD PREVAP PREVMI PREVSTRK PREVHYP TIME PERIOD HDLC
## 1       69      92    4       0      0      0        0       0 4628      3   31
## 2       80      71    2       0      0      0        0       0 4344      3   54
## 3       74      NA    3       0      0      0        0       1 4285      3   NA
## 4       86      81    2       0      0      0        0       1 4351      3   46
## 5       75      87    2       0      0      0        0       0 4289      3   34
## 6       92      82    1       0      0      0        0       1 4438      3   44
##   LDLC DEATH ANGINA HOSPMI MI_FCHD ANYCHD STROKE CVD HYPERTEN TIMEAP TIMEMI
## 1  178     0      0      1       1      1      0   1        0   8766   6438
## 2  141     0      0      0       0      0      0   0        0   8766   8766
## 3   NA     0      0      0       0      0      0   0        1   8766   8766
## 4  135     0      0      0       1      1      0   1        1   8766   8766
## 5  286     0      0      0       0      0      0   0        1   8766   8766
## 6  236     0      0      0       0      0      0   0        1   8766   8766
##   TIMEMIFC TIMECHD TIMESTRK TIMECVD TIMEDTH TIMEHYP SEX_char  DIABETES_char
## 1     6438    6438     8766    6438    8766    8766     male Not a diabetic
## 2     8766    8766     8766    8766    8766    8766   female Not a diabetic
## 3     8766    8766     8766    8766    8766    4285   female Not a diabetic
## 4     5719    5719     8766    5719    8766       0   female       Diabetic
## 5     8766    8766     8766    8766    8766    8679   female Not a diabetic
## 6     8766    8766     8766    8766    8766       0     male Not a diabetic
##    log_AGE
## 1 3.951244
## 2 4.060443
## 3 4.060443
## 4 4.007333
## 5 4.043051
## 6 4.158883
\end{verbatim}

\textbf{EXERCISE 17} Add an additional column to the dataset that is a
logarithmic transformation of \texttt{HEARTRTE}. Display the age, log of
age, heart rate, and log of heart rate columns for the first 6
observations. If you want to save the manipulated dataset, you have to
store it as a variable using \texttt{\textless{}-}. You can also
overwrite the original dataset the same way. Without using
\texttt{\textless{}-} the manipulated dataset will not be saved.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Your turn}
\NormalTok{data_e13 <-}\StringTok{ }\KeywordTok{mutate}\NormalTok{(data,}
                   \DataTypeTok{log_AGE =} \KeywordTok{log}\NormalTok{(AGE), }
                   \DataTypeTok{log_HEARTRTE =} \KeywordTok{log}\NormalTok{(HEARTRTE)) }

\NormalTok{data_e13 <-}\StringTok{ }\KeywordTok{select}\NormalTok{(data_e13, AGE, log_AGE, HEARTRTE, log_HEARTRTE)}

\KeywordTok{head}\NormalTok{(data_e13) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   AGE  log_AGE HEARTRTE log_HEARTRTE
## 1  52 3.951244       69     4.234107
## 2  58 4.060443       80     4.382027
## 3  58 4.060443       74     4.304065
## 4  55 4.007333       86     4.454347
## 5  57 4.043051       75     4.317488
## 6  64 4.158883       92     4.521789
\end{verbatim}

When a variable is created, it becomes instantly available to use in the
same \texttt{mutate()} function to create new variables. The following
command takes the \texttt{log()} of \texttt{AGE} and then taking the
\texttt{exp()} of the new variable to return the original \texttt{AGE}
value.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(}\KeywordTok{mutate}\NormalTok{(data, }\DataTypeTok{log_AGE =} \KeywordTok{log}\NormalTok{(AGE), }\DataTypeTok{AGE_new =} \KeywordTok{exp}\NormalTok{(log_AGE)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID SEX TOTCHOL AGE SYSBP DIABP CURSMOKE CIGPDAY   BMI DIABETES BPMEDS
## 1   2448   1     209  52   121    66        0       0    NA        0      0
## 2   6238   2     237  58   108    66        0       0 28.50        0      0
## 3  11252   2      NA  58   155    90        1      30 24.61        0      0
## 4  11263   2     220  55   180   106        0       0 31.17        1      1
## 5  12806   2     320  57   110    46        1      30 22.02        0      0
## 6  14367   1     280  64   168   100        0       0 25.72        0      0
##   HEARTRTE GLUCOSE educ PREVCHD PREVAP PREVMI PREVSTRK PREVHYP TIME PERIOD HDLC
## 1       69      92    4       0      0      0        0       0 4628      3   31
## 2       80      71    2       0      0      0        0       0 4344      3   54
## 3       74      NA    3       0      0      0        0       1 4285      3   NA
## 4       86      81    2       0      0      0        0       1 4351      3   46
## 5       75      87    2       0      0      0        0       0 4289      3   34
## 6       92      82    1       0      0      0        0       1 4438      3   44
##   LDLC DEATH ANGINA HOSPMI MI_FCHD ANYCHD STROKE CVD HYPERTEN TIMEAP TIMEMI
## 1  178     0      0      1       1      1      0   1        0   8766   6438
## 2  141     0      0      0       0      0      0   0        0   8766   8766
## 3   NA     0      0      0       0      0      0   0        1   8766   8766
## 4  135     0      0      0       1      1      0   1        1   8766   8766
## 5  286     0      0      0       0      0      0   0        1   8766   8766
## 6  236     0      0      0       0      0      0   0        1   8766   8766
##   TIMEMIFC TIMECHD TIMESTRK TIMECVD TIMEDTH TIMEHYP SEX_char  DIABETES_char
## 1     6438    6438     8766    6438    8766    8766     male Not a diabetic
## 2     8766    8766     8766    8766    8766    8766   female Not a diabetic
## 3     8766    8766     8766    8766    8766    4285   female Not a diabetic
## 4     5719    5719     8766    5719    8766       0   female       Diabetic
## 5     8766    8766     8766    8766    8766    8679   female Not a diabetic
## 6     8766    8766     8766    8766    8766       0     male Not a diabetic
##    log_AGE AGE_new
## 1 3.951244      52
## 2 4.060443      58
## 3 4.060443      58
## 4 4.007333      55
## 5 4.043051      57
## 6 4.158883      64
\end{verbatim}

\textbf{EXERCISE 18} Multiply \texttt{BMI} by 2 and revert the
muliplication to return the orginal \texttt{BMI} value. Only display the
first 6 observations and the two BMI variables.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\KeywordTok{head}\NormalTok{(}\KeywordTok{select}\NormalTok{(}\KeywordTok{mutate}\NormalTok{(data, }\DataTypeTok{BMI_twice =}\NormalTok{ BMI}\OperatorTok{*}\DecValTok{2}\NormalTok{,}
                   \DataTypeTok{BMI =}\NormalTok{ BMI_twice }\OperatorTok{/}\StringTok{ }\DecValTok{2}\NormalTok{), BMI_twice, BMI))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   BMI_twice   BMI
## 1        NA    NA
## 2     57.00 28.50
## 3     49.22 24.61
## 4     62.34 31.17
## 5     44.04 22.02
## 6     51.44 25.72
\end{verbatim}

\texttt{summarise()} creates a summary of a dataset based on a set of
functions provided. It returns a new dataset with columns for each
summary.

If we wanted to compute the mean and variance of \texttt{AGE} for the
Framingham dataset, we would use the following command:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summarise}\NormalTok{(data, }\DataTypeTok{mean_AGE =} \KeywordTok{mean}\NormalTok{(AGE), }\DataTypeTok{variance_AGE =} \KeywordTok{var}\NormalTok{(AGE))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   mean_AGE variance_AGE
## 1 60.64818     68.83633
\end{verbatim}

\textbf{EXERCISE 19} Compute the mean and variance of \texttt{BMI} for
the Framingham dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\KeywordTok{summarise}\NormalTok{(data, }\DataTypeTok{mean_BMI =} \KeywordTok{mean}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }\DataTypeTok{variance_BMI =} \KeywordTok{var}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   mean_BMI variance_BMI
## 1 25.89478     16.65175
\end{verbatim}

\textbf{EXERCISE 20} Calculate the mean and variance of \texttt{BMI}
whilst removing the missing values.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\KeywordTok{summarise}\NormalTok{(data, }\DataTypeTok{mean_BMI =} \KeywordTok{mean}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
          \DataTypeTok{variance_BMI =} \KeywordTok{var}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   mean_BMI variance_BMI
## 1 25.89478     16.65175
\end{verbatim}

We can create subgroups in our datasets, to calculate summary measures
for different patient subgroups. Firstly, we create the groups using the
\texttt{group\_by()} function, e.g.~to group by \texttt{SEX\_char}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data_grouped <-}\StringTok{ }\KeywordTok{group_by}\NormalTok{(data, SEX_char)}
\end{Highlighting}
\end{Shaded}

We can then use the \texttt{summarise()} function to return a summary
for each group in our new dataset. For example, we can estimate the mean
and variance of \texttt{AGE} for men and women.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summarise}\NormalTok{(data_grouped, }\DataTypeTok{mean_AGE =} \KeywordTok{mean}\NormalTok{(AGE), }\DataTypeTok{variance_AGE =} \KeywordTok{var}\NormalTok{(AGE))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##   SEX_char mean_AGE variance_AGE
##   <fct>       <dbl>        <dbl>
## 1 female       60.9         70.0
## 2 male         60.3         67.1
\end{verbatim}

\textbf{EXERCISE 21} Group the data by \texttt{DIABETES\_char} and
estimate the mean, median, variance and standard deviation of `BMI' for
diabetic and non-diabetic groups. Display the summary.

\begin{itemize}
\tightlist
\item
  \texttt{median} is the \texttt{R} function to find the median
\item
  \texttt{sd} is the \texttt{R} function to find the standard deviation.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data_grouped1 <-}\StringTok{ }\KeywordTok{group_by}\NormalTok{(data, DIABETES_char)}
\KeywordTok{summarise}\NormalTok{(data_grouped1, }
          \DataTypeTok{mean_BMI =} \KeywordTok{mean}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
          \DataTypeTok{median_BMI =} \KeywordTok{median}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
          \DataTypeTok{variance_BMI =} \KeywordTok{var}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
          \DataTypeTok{sd_BMI =} \KeywordTok{sd}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   DIABETES_char  mean_BMI median_BMI variance_BMI sd_BMI
##   <chr>             <dbl>      <dbl>        <dbl>  <dbl>
## 1 Diabetic           27.2       26.2         27.5   5.24
## 2 Not a diabetic     25.8       25.4         15.6   3.95
\end{verbatim}

We can also group and summarize using multiple variables. This creates a
summary for each unique subgroup combination of the variables. For
example, we could group our dataset \texttt{data} by \texttt{SEX\_char}
and \texttt{DIABETES\_char} creating 4 subgroups:

\begin{itemize}
\tightlist
\item
  Males who are diabetic
\item
  Males who are not diabetic
\item
  Females who are not diabetic
\item
  Females who are diabetic
\end{itemize}

\textbf{EXERCISE 22} Estimate the mean and variance of \texttt{AGE} for
the above 4 subgroups.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data_grouped2 <-}\StringTok{ }\KeywordTok{group_by}\NormalTok{(data, SEX_char, DIABETES_char)}
\KeywordTok{summarise}\NormalTok{(data_grouped2, }\DataTypeTok{mean_AGE =} \KeywordTok{mean}\NormalTok{(AGE), }
          \DataTypeTok{variance_AGE =} \KeywordTok{var}\NormalTok{(AGE))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 4
## # Groups:   SEX_char [2]
##   SEX_char DIABETES_char  mean_AGE variance_AGE
##   <fct>    <chr>             <dbl>        <dbl>
## 1 female   Diabetic           64.8         65.5
## 2 female   Not a diabetic     60.6         69.2
## 3 male     Diabetic           62.6         63.4
## 4 male     Not a diabetic     60.1         67.0
\end{verbatim}

\hypertarget{data-manipulation-with-pipe}{%
\section{\texorpdfstring{6. Data manipulation with
\texttt{pipe}}{6. Data manipulation with pipe}}\label{data-manipulation-with-pipe}}

The \emph{pipe} operator (\texttt{\%\textgreater{}\%}) is a part of the
\texttt{dplyr} package. This offers a convenient and concise way of
performing a sequence of data manipulations.

The operator \texttt{\%\textgreater{}\%} \emph{pipe} their value to the
left-hand of the operator forward into expressions on the right-hand
side,

i.e.~one can replace \texttt{f(x)} with
\texttt{x\ \%\textgreater{}\%\ f(.)}, where \texttt{f(.)} can be any
function in \texttt{R}. For example, instead of writing
\texttt{ncol(data)} we can have
\texttt{data\ \%\textgreater{}\%\ ncol(.)}, where \texttt{.} is a place
holder for the object on the left-hand side.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# calculate the number of columns in our dataset}
\NormalTok{data }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ncol}\NormalTok{(.) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 41
\end{verbatim}

The benefits are more apparent when you have a bigger series of
operations to be carried out sequentially.

\begin{itemize}
\item
  If you have multiple pipes, the output from the previous \emph{pipe}
  operation is the input of the next \emph{pipe} operation. An easy way
  to remember this is that whatever is on the left-hand side is always
  the input of the \emph{pipe} that follows immediately.
\item
  \emph{Pipe} works very well with the functions in the \texttt{dplyr}
  package.
\item
  Most of the time \emph{pipe} is used on a dataframe object since the
  funcitons in the \texttt{dplyr} package can only be applied to
  dataframes.
\end{itemize}

In the following command first subselects subjects over 60 years old
using \emph{pipe} and then selects the variables \texttt{RANDID} and
\texttt{AGE}.

dplyr\texttt{knows\ that\ you\ are\ using\ the\ data\ on\ the\ left-hand\ side\ of\ the\ *pipe*\ thus\ the}.`
is optional.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{filter}\NormalTok{(AGE }\OperatorTok{>}\StringTok{ }\DecValTok{60}\NormalTok{) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{select}\NormalTok{(RANDID, AGE) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   RANDID AGE
## 1  14367  64
## 2  16799  62
## 3  43770  64
## 4  45464  64
## 5  55965  72
## 6  66472  72
\end{verbatim}

\textbf{EXERCISE 23} Subselect subjects with a heart rate of over 80
beats/min, and among them, only keep the ones with a glucose measure of
over 200 mg/dL. Then, only keep the ones with a BMI value. Finally,
display the subject ID, heart rate, glucose and BMI columns for the
first 6 subjects.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data }\OperatorTok{%>%}\StringTok{ }
\StringTok{     }\KeywordTok{filter}\NormalTok{(HEARTRTE }\OperatorTok{>}\StringTok{ }\DecValTok{80}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{     }\KeywordTok{filter}\NormalTok{(GLUCOSE }\OperatorTok{>}\StringTok{ }\DecValTok{200}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{     }\KeywordTok{filter}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(BMI) }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{     }\KeywordTok{select}\NormalTok{(RANDID, HEARTRTE, GLUCOSE, BMI) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    RANDID HEARTRTE GLUCOSE   BMI
## 1  276073       96     265 25.77
## 2 1304801       94     203 31.76
## 3 1842886       90     206 22.31
## 4 2055792      100     334 29.29
## 5 2483517       84     380 22.58
## 6 2976595       94     333 26.92
\end{verbatim}

The following code gives the mean BMI stratified by sex for those over
60 years old.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{filter}\NormalTok{(AGE }\OperatorTok{>}\StringTok{ }\DecValTok{60}\NormalTok{) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{group_by}\NormalTok{(SEX_char) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{Avg_BMI =} \KeywordTok{mean}\NormalTok{(BMI, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 2
##   SEX_char Avg_BMI
##   <fct>      <dbl>
## 1 female      25.9
## 2 male        25.6
\end{verbatim}

\textbf{EXTENSION EXERCISE} Give the mean, median, variance and standard
deviation of systolic blood pressure, stratified by prevalent stroke
(\texttt{PREVSTRK}), among those who are \emph{either} a smoker or a
diabetic.

The \texttt{ifelse()} function takes in an expression as its first
argument, returns the 2nd argument when the expression is satisfied, and
returns the 3rd argument when it is not. Try the following code:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ifelse}\NormalTok{(}\DecValTok{2} \OperatorTok{<}\StringTok{ }\DecValTok{3}\NormalTok{, }\StringTok{'Correct'}\NormalTok{, }\StringTok{'Incorrect'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Correct"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ifelse}\NormalTok{(}\DecValTok{1} \OperatorTok{>}\StringTok{ }\DecValTok{10}\NormalTok{, }\StringTok{'Right'}\NormalTok{, }\StringTok{'Wrong'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Wrong"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Your turn}
\NormalTok{data }\OperatorTok{%>%}\StringTok{ }
\StringTok{     }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{DIABETES_SMOKER =} 
              \KeywordTok{ifelse}\NormalTok{(DIABETES }\OperatorTok{==}\StringTok{ }\DecValTok{1} \OperatorTok{|}\StringTok{ }\NormalTok{CURSMOKE }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{PREVSTRK_char =} \KeywordTok{ifelse}\NormalTok{(PREVSTRK }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\StringTok{'Yes'}\NormalTok{, }\StringTok{'No'}\NormalTok{),}
            \DataTypeTok{PREVSTRK_char =} \KeywordTok{factor}\NormalTok{(PREVSTRK_char, }\DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\StringTok{"Yes"}\NormalTok{, }\StringTok{"No"}\NormalTok{))) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{filter}\NormalTok{(DIABETES_SMOKER }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{group_by}\NormalTok{(PREVSTRK_char) }\OperatorTok{%>%}
\StringTok{     }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{mean_SYSBP =} \KeywordTok{mean}\NormalTok{(SYSBP, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
               \DataTypeTok{median_SYSBP =} \KeywordTok{median}\NormalTok{(SYSBP, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
               \DataTypeTok{variance_SYSBP =} \KeywordTok{var}\NormalTok{(SYSBP, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
               \DataTypeTok{sd_SYSBP =} \KeywordTok{sd}\NormalTok{(SYSBP, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   PREVSTRK_char mean_SYSBP median_SYSBP variance_SYSBP sd_SYSBP
##   <fct>              <dbl>        <dbl>          <dbl>    <dbl>
## 1 Yes                 159           155           542.     23.3
## 2 No                  139.          135           571.     23.9
\end{verbatim}

\end{document}
