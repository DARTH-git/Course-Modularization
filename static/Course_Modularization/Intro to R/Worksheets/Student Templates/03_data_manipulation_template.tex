% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Intro to R for Decision Modeling},
  pdfauthor={SickKids and DARTH},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Intro to R for Decision Modeling}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{Data Manipulation}
\author{SickKids and DARTH}
\date{}

\begin{document}
\maketitle

Change \texttt{eval} to \texttt{TRUE} if you want to knit this document.

\hypertarget{general}{%
\subsection{General}\label{general}}

This session presents the key commands needed to manipulate a dataset in
\texttt{R}. This worksheet is split into the following sections:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Data input and output
\item
  Subselecting data
\item
  Identifying and replacing data
\item
  Calculating useful statistics
\item
  Data manipulation with \texttt{dplyr}
\item
  Data manipulation with \texttt{pipe}
\end{enumerate}

Throughout the course, we will demonstrate code and leave some empty
\emph{code chunks} for you to fill in. We will also provide solutions
after the session.

Feel free to modify this document with your own comments and
clarifications.

\hypertarget{data-input-and-output}{%
\section{1. Data input and output}\label{data-input-and-output}}

\textbf{Input}

There are several ways of loading your data in \texttt{R}. A convenient
way of importing data into \texttt{R} is through tab-delimited text
(.txt) or comma separated (.csv) files. For this course, we have
provided a \texttt{.txt} file that contains the data we are going to be
using.

If you have a dataset to analyze in \texttt{R}, you can save the file as
a tab-delimited or as a comma separated file by opening it in Excel and
clicking \textbf{File -\textgreater{} Save As -\textgreater{} Save as
type} and selecting either the tab delimited or comma separated file
type.

Once you have saved your file, it is time to load it in \texttt{R}:

\begin{itemize}
\tightlist
\item
  \texttt{read.table()} is used to load \texttt{.txt} data
\item
  \texttt{read.csv()} is used to load \texttt{.csv} data.
\end{itemize}

The following example loads everything from a tab-delimited file called
\texttt{course\_data.txt} and creates an \texttt{R} object called
\texttt{mydata} that contains all the data from our file:

\texttt{mydata\ \textless{}-\ read.table(\textquotesingle{}C:/Users/UserName/Documents/course\_data.txt\textquotesingle{},\ header\ =\ TRUE)}

To ensure that \texttt{R} can find your file, you need to specify the
\emph{filepath} of your dataset
(C:/Users/UserName/Documents/course\_data.txt). The easiest way to find
this filepath in Windows is to navtigate to the file in the file
explorer, right click on the file, select Properties and copy the
\textbf{Location:} into \texttt{R} (\texttt{C:/Users/UserName/Documents}
in the above example). On a Mac, you can hold down the command button,
right click and choose the option \textbf{Copy File Path}.

\begin{itemize}
\item
  When you copy directly, you need to change the backslashes in the
  filepath to forward slashes!
\item
  You then need to add the name of the file and the file extension
  following another forward slash
\item
  You need to enter your \emph{filepath} between two quotation marks
  ('\,').
\end{itemize}

The code above contains the statement \texttt{header\ =\ TRUE} to
specify that the first row of the data contains the variable names for
your dataset. The data is also loaded and saved as an \emph{object} so
it can be used later for our data manipulation and analysis.

If your data file and the \texttt{R} file that loads the data file are
in the same folder, you can avoid typing your filepath by navigating to
the top bar of RStudio and click `Session' -\textgreater{} `Set Working
Directory' -\textgreater{} `To Source File Location'. This sets the
default filepath in \texttt{R}, often referred as the working directory,
to the filepath of your \texttt{R} or R Mardkown file that is currently
opened.

\textbf{EXERCISE 1} Use the function \texttt{read.csv()} to read in
\texttt{framingham.csv}, the dataset provided for the exercises of this
workshop. Store the dataset as a variable named \texttt{data}. You can
use the \emph{code chunk} below.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\textbf{Output}

When you are done with your statistical analysis and you want to export
the output of your work, you can use the \texttt{write.table()} function
to export the output as a tab delimited file or the \texttt{write.csv()}
function to export the output as a \texttt{.csv} file.

\texttt{write.table(mydata,\ file\ =\ \textquotesingle{}course\_data\_export.txt\textquotesingle{})}
exports the \texttt{R} object \texttt{mydata} back to a tab delimited
text file.

\texttt{write.csv(data,\ file\ =\ \textquotesingle{}framingham\_export.csv\textquotesingle{})}
exports the \texttt{R} object \texttt{mydata} back to a \texttt{.csv}
file.

To export to a specific file, you should use the entire \emph{filepath}
as described above. In the code above, the data would be saved to
\texttt{R}'s \emph{working directory}. This is default folder where
\texttt{R} will save all your results unless you specify the filepath.
You can find out the current working directory using:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{getwd}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

It is possible to change the \emph{working directory}, using the command
\texttt{setwd()} and specifying the \emph{path} to a specific folder.
You can also set the working directory to your current file location
using \textbf{Session -\textgreater{} Set Working Directory
-\textgreater{} To Source File Location}.

\hypertarget{subselecting-data}{%
\section{2. Subselecting data}\label{subselecting-data}}

Most data manipulation in \texttt{R} involves comparing two values using
a \emph{relational operator}.

\texttt{R}'s relational operators compare two values and return either
TRUE or FALSE depending on the value and the comparison. The simplest
relational operator is the ``equal to'' operator (\texttt{==}) which
tests whether two values are the same.

The following table provides a list of \texttt{R}'s relational operators
and examples of possible logical expressions.

\begin{longtable}[]{@{}lll@{}}
\toprule
Relational Operators & Description & Example logical expression \\
\midrule
\endhead
\texttt{==} & equal to & \texttt{gender\ ==\ "male"} \\
\texttt{!=} & not equal & \texttt{gender\ !=\ "male"} \\
\texttt{\textless{}} & less than & \texttt{age\ \textless{}\ 40} \\
\texttt{\textgreater{}} & greater than &
\texttt{age\ \textgreater{}\ 10} \\
\texttt{\textless{}=} & less than or equal to &
\texttt{age\ \textless{}=\ 40} \\
\texttt{\textgreater{}=} & greater than or equal to &
\texttt{age\ \textgreater{}=\ 40} \\
\texttt{\%in\%} & in & \texttt{age\ \%in\%\ c(30,31,32)} \\
\bottomrule
\end{longtable}

\textbf{EXERCISE 2} Create two \texttt{R} objects called \texttt{gender}
and \texttt{age}. In the \emph{code chunk} below, run a few example
logical expressions from the table above.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# prep}
\NormalTok{gender }\OtherTok{\textless{}{-}} \StringTok{"male"}
\NormalTok{gender }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"other"}\NormalTok{)}
\NormalTok{age    }\OtherTok{\textless{}{-}} \DecValTok{80}

\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

When comparing a vector to a single item, the logical expression returns
TRUE or FALSE for each item in the vector depending on the logical
comparison.

\textbf{EXERCISE 3} Run the following \emph{code chunk} to understand
vectors and logical comparisons:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vectors and Relational Operators}
\NormalTok{genders }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{,}\StringTok{"male"}\NormalTok{,}\StringTok{"female"}\NormalTok{)}
\NormalTok{genders }\SpecialCharTok{==} \StringTok{"male"}
\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{) }\SpecialCharTok{\textgreater{}} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

Comparing vectors of the same length compares the \(i^{th}\) element in
the first vector to the \(i^{th}\) element in the second vector.

\textbf{EXERCISE 4} Run the following \emph{code chunk} to understand
vectors and logical comparisons:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vectors and Relational Operators}
\NormalTok{genders }\SpecialCharTok{==} \FunctionTok{c}\NormalTok{(}\StringTok{"Bridge"}\NormalTok{, }\StringTok{"Building"}\NormalTok{, }\StringTok{"male"}\NormalTok{, }\StringTok{"Road"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

We can combine the relational operators with \texttt{R}'s logical
operators of and (\texttt{\&}) and or (\texttt{\textbar{}}) to create
more complex logical expressions.

\begin{itemize}
\tightlist
\item
  \texttt{\&} returns TRUE when both expressions on the left and right
  side of the ampersand return TRUE.
\item
  \texttt{\textbar{}} returns TRUE when either of the expressions on the
  left or right side of the \texttt{\textbar{}} returns TRUE.
\end{itemize}

\textbf{EXERCISE 5} Use to code in the following \emph{code chunk} to
understand \texttt{\&} and \texttt{\textbar{}}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\DecValTok{2} \SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&} \StringTok{"a"} \SpecialCharTok{==} \StringTok{"a"}
\DecValTok{2} \SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{|} \StringTok{"a"} \SpecialCharTok{==} \StringTok{"a"}
\end{Highlighting}
\end{Shaded}

\textbf{Subselecting rows or columns in a dataset}

There are many cases where you will need to select specific rows or
columns of your data after you load it in \texttt{R}, for example:

\begin{itemize}
\item
  You may import more variables into \texttt{R} than you would like to
  use in the analysis.
\item
  Subjects may need to be excluded from further analysis, e.g.~for
  incomplete data or outlier testing.
\item
  You might want to stratify your data into two or more categories
  before proceeding with the analysis.
\end{itemize}

This is called subsetting or subselecting and can be easily performed in
\texttt{R}.

If you want to create a new dataset \texttt{data\_new} that only
contains the first five columns of the Framingham dataset, we type the
following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_new }\OtherTok{\textless{}{-}}\NormalTok{ data[ , }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

Remember, the Framingham dataset is stored in an \emph{object} called
\texttt{data} that we loaded earlier.

In \texttt{R}, the statement \texttt{1:5} is read as `from 1 to 5' and
specifies that we should select columns, 1, 2, 3, 4, 5.

\textbf{EXERCISE 6} Create a new dataset named \texttt{data\_new} that
only contains the first 10 columns of the Framingham dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

The \texttt{data} \emph{object} is stored by \texttt{R} as a data frame.
As data frame has columns that contains the different variables and rows
that contain information about each subject. In the above code, we
selected a specific subset of the \emph{columns}. We can also select a
specific subset of \emph{rows} by placing numbers before the comma,
e.g.~

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data1 }\OtherTok{\textless{}{-}}\NormalTok{ data[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{]}
\FunctionTok{head}\NormalTok{(data1)}
\end{Highlighting}
\end{Shaded}

Subselects the first five columns from the first five subjects only and
stores them in a variable called \texttt{data1}.

You can also subselect columns and rows by their name, e.g.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data2 }\OtherTok{\textless{}{-}}\NormalTok{ data[, }\FunctionTok{c}\NormalTok{(}\StringTok{"SEX"}\NormalTok{, }\StringTok{"AGE"}\NormalTok{, }\StringTok{"BMI"}\NormalTok{, }\StringTok{"HEARTRTE"}\NormalTok{, }\StringTok{"GLUCOSE"}\NormalTok{)]}
\FunctionTok{head}\NormalTok{(data2)}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 7} Create a new dataset named `data2\_new' that
contains the first 10 subjects and the subject ID, sex, age, bmi, heart
rate and glucose columns from the Framingham dataset. Then, take a quick
glance of the new dataset.

\begin{itemize}
\item
  You can see the names of the columns of a dataset using the command
  \texttt{colnames(data)}, you can also look at the data dictionary.
\item
  The function \texttt{head()} takes a dataset and returns the first 6
  rows and all columns. It is a very useful function to get a quick
  glace of your data.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

It is also possible to subset with logical expressions and select the
rows or columns of a data frame that fulfils a certain condition. For
example, we can extract and present all rows of our \texttt{data} where
the participant is older than 30.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(data[data}\SpecialCharTok{$}\NormalTok{AGE }\SpecialCharTok{\textgreater{}} \DecValTok{30}\NormalTok{,])}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{data\$AGE} is shorthand in \texttt{R} for
  \texttt{data{[},"AGE"{]}}. In general, you can use the \$ sign
  followed by the name of the variable to select a specific column of a
  data set. You can only use this shorthand to select a single column
  from a data frame.
\end{itemize}

\textbf{EXERCISE 8} Create a new dataset called \texttt{data3} that
contains all the subject ID, sex, age, BMI and hear rates for the
subjects whose heart rate is greater than 100. Display the first 6 rows.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\hypertarget{identifying-and-replacing-data}{%
\section{3. Identifying and replacing
data}\label{identifying-and-replacing-data}}

\textbf{Identifying missing values}

Datasets are hardly ever complete. Missing values in data are very
common and problematic in analysis procedures as they can cause issues
with the analysis. It is usefull to identify, and potentially, replace
or remove missing values from a dataset.

\texttt{R} assigns the value \texttt{NA} (Not Available) in every cell
of a data frame that is missing.

To identify missing values, you can use the function \texttt{is.na()}.
This function returns a logical vector or matrix (depending on the
input) with the value TRUE where there is an NA and FALSE where the data
are complete. For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{9}\NormalTok{, }\ConstantTok{NA}\NormalTok{)}
\FunctionTok{is.na}\NormalTok{(b)}
\end{Highlighting}
\end{Shaded}

If you want to subselect subjects without missing data for the a heart
rate. You could use the function \texttt{is.na()} to identify the
subjects that have no missing values in their heart rate variable and
exclude them:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{No\_missing\_heartrate\_data }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{is.na}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{HEARTRTE) }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 9} Subselect subjects without any glucose information.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\texttt{R} also has a function \texttt{na.omit()}, that removes all
observations with missing values in any of the columns.

\textbf{EXERCISE 10} Calculate the number of observations in our data
that does not have any missing values for the heart rate and glucose
columns. Hint: The \texttt{nrow()} and \texttt{ncol()} functions give
the total number of rows and columns of a dataset, respectively, when
used on a dataset. Also when using \texttt{sum()} on a vector of
\texttt{TRUE} and \texttt{FALSES} returns the number of \texttt{TRUE} in
the vector.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\textbf{Identifying and replacing values in a dataset}

It is also possible to find and replace values in a dataset. For
example, we may want to create a new variable named \texttt{SEX\_char}
for the existing Framingham dataset. We want our new varible to be equal
to ``male'' when \texttt{SEX} is equal to 1 and ``female'' when
\texttt{SEX} equals 2. This is achieved using the following commands.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Creating a new variable}
\NormalTok{data}\SpecialCharTok{$}\NormalTok{SEX\_char[data}\SpecialCharTok{$}\NormalTok{SEX }\SpecialCharTok{==} \DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}male\textquotesingle{}}
\NormalTok{data}\SpecialCharTok{$}\NormalTok{SEX\_char[data}\SpecialCharTok{$}\NormalTok{SEX }\SpecialCharTok{==} \DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}female\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 11} Construct a new variable named
\texttt{DIABETES\_char} within the Framingham dataset. In this variable,
all \texttt{DIABETES} elements equal to `0' should be given the
character string `Not a diabetic', and all elements equal to `1' should
be given the character string `Diabetic'.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

You can also replace \texttt{NA} values with a numerical value. For
example, if all subjects with missing values are not diabetic, we can
correct this using the \texttt{R} code below

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Updated missingness}
\NormalTok{data}\SpecialCharTok{$}\NormalTok{DIABETES[}\FunctionTok{is.na}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{DIABETES)] }\OtherTok{\textless{}{-}} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

\textbf{Factors}

If some of the predictors have a categorical structure, we need to
ensure that \texttt{R} recognizes these as \emph{factors} as opposed to
numerical values. When we create \emph{factors}, we can also decide
which category is going to be used as the reference level.

\begin{itemize}
\item
  The function \texttt{factor()} turns a character variable into a
  factor variable.
\item
  The function \texttt{levels()} shows the categories, or \emph{levels},
  of a factor, in ascending order. The first level by default is the
  reference category when inserted into a regression model.
\end{itemize}

The following code makes \texttt{SEX} into a factor variable and display
the level.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}\SpecialCharTok{$}\NormalTok{SEX\_char }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{SEX\_char)}
\FunctionTok{levels}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{SEX\_char)}
\end{Highlighting}
\end{Shaded}

\hypertarget{calculating-useful-statistics}{%
\section{4. Calculating useful
statistics}\label{calculating-useful-statistics}}

Assume you want to calculate the arithmetic mean and variance of the age
of your Framingham sample. You can easily do this by typing:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(data1}\SpecialCharTok{$}\NormalTok{AGE)}
\FunctionTok{var}\NormalTok{(data1}\SpecialCharTok{$}\NormalTok{AGE)}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 12} Calculate the mean and variance of BMI. Hint: most
statistical functions in \texttt{R} does not automatically exclude
missing values. If your variable has missing values, you need to specify
\texttt{na.rm\ =\ TRUE} or the result will always be \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

There are several functions in \texttt{R} to compute different
descriptive statistics:

\begin{itemize}
\tightlist
\item
  \texttt{median()}: Calculates the median for the data
\item
  \texttt{min()}: Finds the minimum value for the data
\item
  \texttt{max()}: Finds the maximum value for the data
\item
  \texttt{sd()}: Calculates the standard deviation of the data
\item
  \texttt{quantile()}: Find data quantiles, by default the min, 25\%
  quantile, median, 75\% quantile and the maximum.
\end{itemize}

\texttt{summary()} is a useful function that produces various common
statistics in one go.

\textbf{EXERCISE 13} Call the \texttt{summary()} function on BMI and see
what types of statistics it gives.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

We can use subsetting to calculate summary statistics for different
subgroups in our data. For example, we can compute the mean and variance
of age for men and women:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 14} Calculate the median and max of BMI for those who
are over 60 years old with a heart rate of over 100 beats/min.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

We can calculate the correlation between two or more variables using the
\texttt{cor()} function. There are three methods for calculating
correlation supported within \texttt{R} (Pearson, Kendal or Spearman
method), more information can be found by running \texttt{?cor}.

To calculate the Pearson correlation coefficient for BMI and systolic
blood pressure, we use:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{AGE, data}\SpecialCharTok{$}\NormalTok{SYSBP)}
\end{Highlighting}
\end{Shaded}

If you want to calculate the correlations across several continuous
variables in your dataset, the \texttt{cor()} function can be called on
a data frame.

\textbf{EXERCISE 15} Create a new dataset that only contains age, BMI,
heart rate, glucose and systolic blood pressure. Use the \texttt{cor()}
function to find the pairwise correlations between all these variables.

Note that \texttt{cor()} does not automatically exclude missing values.
This can be achieved using the option
\texttt{use\ =\ "pairwise.complete.obs"} in the \texttt{cor()} function.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-manipulation-with-dplyr}{%
\section{\texorpdfstring{5. Data manipulation with
\texttt{dplyr}}{5. Data manipulation with dplyr}}\label{data-manipulation-with-dplyr}}

When manipulating larger datasets the \texttt{dplyr} package provides a
set of functions that are easier to read, modify, and computationally
faster than the code we showed above.

We will be focusing on these five functions:

\begin{itemize}
\tightlist
\item
  \texttt{filter()} for selecting rows based on observational
  characteristics
\item
  \texttt{select()} for selecting variables based on their names
\item
  \texttt{mutate()} for creating new variables
\item
  \texttt{summarise()} for summarizing data
\item
  \texttt{group\_by()} for sub-population analysis
\end{itemize}

Let's start by loading the \texttt{dplyr} package that you installed in
the previous session.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

An important thing to note is that all \texttt{dplyr} functions use the
dataset (e.g.~\texttt{data}) as the first argument.

The function \texttt{filter()} returns a new dataset with all the
observations that satisfy a set of logical expressions.

For example, we can select all the male participants (represented as 1)
in the Framingham dataset who are under 40 years old and have a heart
rate of over 100 beats/min (and use \texttt{head()} to only print the
first 5 rows):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(}\FunctionTok{filter}\NormalTok{(data, SEX }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, AGE }\SpecialCharTok{\textgreater{}} \DecValTok{40}\NormalTok{, HEARTRTE }\SpecialCharTok{\textgreater{}} \DecValTok{100}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 16} Select all female participants (represented as a 2
in the \texttt{SEX} variable) in the Framingham dataset who are over 50
years old and have a glucose measurement of over 100 mg/dL. Only display
the first 6 observations.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\texttt{select()} allows you to select variables from a dataset based on
the variable names. To select \texttt{SEX}, \texttt{AGE}, \texttt{BMI}
\texttt{HEARTRTE} and \texttt{GLUCCOSE} from the Framingham dataset, the
following command is used:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(}\FunctionTok{select}\NormalTok{(data, SEX, AGE, BMI, HEARTRTE, GLUCOSE))}
\end{Highlighting}
\end{Shaded}

It is also possible to remove variables from a dataset by including
\texttt{-}. To remove our newly created \texttt{DIABETES} variable from
\texttt{data} you can type:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(}\FunctionTok{select}\NormalTok{(data, }\SpecialCharTok{{-}}\NormalTok{DIABETES))}
\end{Highlighting}
\end{Shaded}

Be careful, once you remove a variable from a dataset you cannot recover
it. Therefore, you should usually make a copy of the original dataset
and manipulate the copy.

\texttt{mutate()} creates new variables in a dataset. The following
command creates a new variable that is the logarithmic transformation of
\texttt{AGE}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{log\_AGE =} \FunctionTok{log}\NormalTok{(AGE)))}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 17} Add an additional column to the dataset that is a
logarithmic transformation of \texttt{HEARTRTE}. Display the age, log of
age, heart rate, and log of heart rate columns for the first 6
observations .

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

When a variable is created, it becomes instantly available to use in the
same \texttt{mutate()} function to create new variables. The following
command takes the \texttt{log()} of \texttt{AGE} and then taking the
\texttt{exp()} of the new variable to return the original \texttt{AGE}
value.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{log\_AGE =} \FunctionTok{log}\NormalTok{(AGE), }\AttributeTok{AGE =} \FunctionTok{exp}\NormalTok{(log\_AGE)))}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 18} Create two variables, \texttt{BMI} multiplied by 2
and the log of the variable you just cretated (BMI times 2). Use the
\texttt{head} function to only display the first 6 observations and the
two BMI variables.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\texttt{summarise()} creates a summary of a dataset based on a set of
functions provided. It returns a new dataset with columns for each
summary.

If we wanted to compute the mean and variance of \texttt{AGE} for the
Framingham dataset, we would use the following command:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summarise}\NormalTok{(data, }\AttributeTok{mean\_AGE =} \FunctionTok{mean}\NormalTok{(AGE), }\AttributeTok{variance\_AGE =} \FunctionTok{var}\NormalTok{(AGE))}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 19} Compute the mean and variance of \texttt{BMI} for
the Framingham dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

We can create subgroups in our datasets, to calculate summary measures
for different patient subgroups. Firstly, we create the groups using the
\texttt{group\_by()} function, e.g.~to group by \texttt{SEX\_char}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_grouped }\OtherTok{\textless{}{-}} \FunctionTok{group\_by}\NormalTok{(data, SEX\_char)}
\end{Highlighting}
\end{Shaded}

We can then use the \texttt{summarise()} function to return a summary
for each group in our new dataset. For example, we can estimate the mean
and variance of \texttt{AGE} for men and women.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summarise}\NormalTok{(data\_grouped, }\AttributeTok{mean\_AGE =} \FunctionTok{mean}\NormalTok{(AGE), }\AttributeTok{variance\_AGE =} \FunctionTok{var}\NormalTok{(AGE))}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 21} Group the data by \texttt{DIABETES} and estimate
the mean, median, variance and standard deviation of `BMI' for diabetic
and non-diabetic groups. Display the summary.

\begin{itemize}
\tightlist
\item
  \texttt{median} is the \texttt{R} function to find the median
\item
  \texttt{sd} is the \texttt{R} function to find the standard deviation.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

We can also group and summarize using multiple variables. This creates a
summary for each unique subgroup combination of the variables. For
example, we could group our dataset \texttt{data} by \texttt{SEX\_char}
and \texttt{DIABETES\_char} creating 4 subgroups:

\begin{itemize}
\tightlist
\item
  Males who are diabetic
\item
  Males who are not diabetic
\item
  Females who are not diabetic
\item
  Females who are diabetic
\end{itemize}

\textbf{EXERCISE 22} Estimate the mean and variance of \texttt{AGE} for
the above 4 subgroups.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-manipulation-with-pipe}{%
\section{\texorpdfstring{6. Data manipulation with
\texttt{pipe}}{6. Data manipulation with pipe}}\label{data-manipulation-with-pipe}}

The \emph{pipe} operator (\texttt{\%\textgreater{}\%}) is a part of the
\texttt{dplyr} package. This offers a convenient and concise way of
performing a sequence of data manipulations.

The operator \texttt{\%\textgreater{}\%} \emph{pipe} their value to the
left-hand of the operator forward into expressions on the right-hand
side.

\begin{itemize}
\tightlist
\item
  If you have multiple pipes, the output from the previous \emph{pipe}
  operation is the input of the next \emph{pipe} operation. An easy way
  to remember this is that whatever is on the left-hand side is always
  the input of the \emph{pipe} that follows immediately.
\end{itemize}

In the following command first subselects subjects over 60 years old
using \emph{pipe} and then selects the variables \texttt{RANDID} and
\texttt{AGE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%}
     \FunctionTok{filter}\NormalTok{(AGE }\SpecialCharTok{\textgreater{}} \DecValTok{60}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
     \FunctionTok{select}\NormalTok{(RANDID, AGE) }\SpecialCharTok{\%\textgreater{}\%}
     \FunctionTok{head}\NormalTok{()}

\CommentTok{\# VS }

\NormalTok{temp1 }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(data, AGE }\SpecialCharTok{\textgreater{}}\DecValTok{60}\NormalTok{)}
\NormalTok{temp2 }\OtherTok{\textless{}{-}} \FunctionTok{select}\NormalTok{(temp1,RANDID, AGE)}
\FunctionTok{head}\NormalTok{(temp2)}

\CommentTok{\# OR }

\FunctionTok{head}\NormalTok{(}\FunctionTok{select}\NormalTok{(}\FunctionTok{filter}\NormalTok{(data, AGE }\SpecialCharTok{\textgreater{}} \DecValTok{60}\NormalTok{), RANDID, AGE))}
\end{Highlighting}
\end{Shaded}

\textbf{EXERCISE 23} Subselect subjects with a heart rate of over 80
beats/min and select the subject ID, heart rate, glucose and BMI
columns.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}

The following code gives the mean BMI stratified by sex for those over
60 years old.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%}
     \FunctionTok{filter}\NormalTok{(AGE }\SpecialCharTok{\textgreater{}} \DecValTok{60}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
     \FunctionTok{group\_by}\NormalTok{(SEX\_char) }\SpecialCharTok{\%\textgreater{}\%}
     \FunctionTok{summarise}\NormalTok{(}\AttributeTok{Avg\_BMI =} \FunctionTok{mean}\NormalTok{(BMI, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{EXTENSION EXERCISE} Give the mean, median, variance and standard
deviation of systolic blood pressure, stratified by prevalent stroke
(\texttt{PREVSTRK}), among those who are \emph{either} a smoker or a
diabetic.

Hint: The \texttt{ifelse()} function takes in an expression as its first
argument, returns the 2nd argument when the expression is satisfied, and
returns the 3rd argument when it is not. Try the following code:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ifelse}\NormalTok{(}\DecValTok{2} \SpecialCharTok{\textless{}} \DecValTok{3}\NormalTok{, }\StringTok{\textquotesingle{}Correct\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Incorrect\textquotesingle{}}\NormalTok{)}
\FunctionTok{ifelse}\NormalTok{(}\DecValTok{1} \SpecialCharTok{\textgreater{}} \DecValTok{10}\NormalTok{, }\StringTok{\textquotesingle{}Right\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Wrong\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Your turn}
\end{Highlighting}
\end{Shaded}


\end{document}
