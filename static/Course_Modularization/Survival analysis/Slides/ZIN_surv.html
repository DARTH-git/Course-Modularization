---
title: "Survival Analysis in Economic Evaluation"
author: ' '
output:
  beamer_presentation: default
  ioslides_presentation: default
  slidy_presentation: default
subtitle: The DARTH Workgroup
---

<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>


<div id="overview" class="section level1">
<h1>Overview</h1>
<ul>
<li>Motivation and introduction in Survival analysis</li>
<li>Survival modeling</li>
<li>Non-parametric modeling</li>
<li>Semi-Parametric modeling</li>
<li>Fully Parametric modeling</li>
<li>Multistate models</li>
<li>Advanced topiics
<ul>
<li>Mixture cure models</li>
<li>External evidence in survival models</li>
</ul></li>
</ul>
</div>
<div id="its-all-about-the-data" class="section level1">
<h1>It’s all about the data!</h1>
<ul>
<li>RCT evidence often not sufficient for Health Technology Assesment (HTA)
<ul>
<li>Short follow up</li>
<li>Patients lost during follow up</li>
<li>Often not reflective of real world</li>
<li>Right skewed<br />
</li>
<li>Information “flowing” over intervals</li>
<li>Extrapolation often necessary</li>
</ul></li>
</ul>
</div>
<div id="bonus-challenges-in-oncology-rcts" class="section level1">
<h1>Bonus challenges in Oncology RCTs</h1>
<ul>
<li>Overall Survival (OS), Progression-Free Survival (PFS)</li>
<li>Trials powered to show differences on PFS and not OS</li>
<li>Cross-over</li>
<li>PFS and OS data are correlated</li>
<li>Access to patient level OS data not always the case</li>
</ul>
</div>
<div id="censoring" class="section level1">
<h1>Censoring</h1>
<p><img src="figures/censoring.PNG" width="100%" /></p>
</div>
<div id="infromative-censoring" class="section level1">
<h1>Infromative Censoring</h1>
<p>The case where survival time is dependent with whatever causes the censoring. Example: A patient in a community study is censored because they are hospitalized (hospitalization indicates severity)</p>
<p>In most of the examples throughout we will make the assumption of non-informative censoring</p>
</div>
<div id="what-is-survival-analysis" class="section level1">
<h1>What is survival analysis</h1>
<ul>
<li>Set of statistical methods that can handle:
<ul>
<li>Data skewness</li>
<li>Censoring</li>
<li>(Time-dependent) Covariates</li>
<li>State transition processes</li>
<li>Recurrent events</li>
<li>The expectation of cure</li>
</ul></li>
<li>Used for both inference and extrapolation</li>
</ul>
</div>
<div id="key-concepts-in-survival-analysis" class="section level1">
<h1>Key Concepts in survival analysis</h1>
<ul>
<li><p>survival to time <span class="math inline">\(T\)</span>: the random variable capturing time since the beginning of the event.</p></li>
<li><p>Survival: the probability of not experiencing an event unit some time <span class="math inline">\(t\)</span>
<span class="math inline">\(S(t) = Pr(T &gt;t) = 1- Pr(T \leq t)\)</span></p></li>
<li><p>Cumulative density function:</p></li>
</ul>
<p><span class="math inline">\(F(t) = Pr(T \leq t)\)</span></p>
<p><span class="math inline">\(F(t) = 1 - S(t)\)</span></p>
<ul>
<li>Hazard function (the instantaneous rate of the event):
<span class="math inline">\(h(t) = \lim_{\delta t \rightarrow 0}\frac{1}{\delta t} \frac{ F(t + \delta t) - F(t)}{S(t)}\)</span></li>
</ul>
<p>turns out
<span class="math inline">\(h(t) = \frac{f(t)}{S(t)}\)</span></p>
<ul>
<li>Cumulative hazard
<span class="math inline">\(H(t) \int^t_0 {h(x)dx}\)</span></li>
</ul>
<p>as well as <span class="math inline">\(S(t) = e^{-H(t)}\)</span></p>
</div>
<div id="example-the-exponential-distribution" class="section level1">
<h1>Example: the exponential distribution</h1>
<ul>
<li><p><span class="math inline">\(H(t) = \lambda t\)</span></p></li>
<li><p><span class="math inline">\(S(t) = exp(-\lambda t)\)</span></p></li>
<li><p><span class="math inline">\(f(t) = \lambda exp(-\lambda t)\)</span></p></li>
<li><p>Weibull , gamma, lognormal etc…</p></li>
</ul>
</div>
<div id="some-shapes-of-hazards" class="section level1">
<h1>Some shapes of hazards</h1>
<p><img src="figures/hazards.PNG" width="100%" /></p>
</div>
<div id="common-distributions-and-hazard-shapes" class="section level1">
<h1>common distributions and hazard shapes</h1>
<ul>
<li>Exponential:constant hazard</li>
<li>Weibull: hazard monotonically increases/decreases</li>
<li>Gompertz: hazard monotonically increases/decreases, but the rate of change is exponential</li>
<li>Log-logistic, log normal: hazard monotonically increases, and can then decrease</li>
</ul>
</div>
<div id="types-of-survival-analysis-models" class="section level1">
<h1>Types of survival analysis models</h1>
<ul>
<li>Non-parametric models (e.g. Kaplan Meier)</li>
<li>Semi-Parametric models (e.g. Cox Proportional Hazard)</li>
<li>Parametric models (e.g. Accelerated Failure Time)</li>
</ul>
</div>
<div id="non-parametric-models" class="section level1">
<h1>Non-Parametric models</h1>
<ul>
<li>known as the “product-limit” estimator. The most used survival analysis method</li>
<li>makes no parametric assumption on the data</li>
</ul>
<p><img src="static/Course_Modularization/Survival analysis/Slides/ZIN_surv_files/figure-html/unnamed-chunk-3-1.png" width="100%" /></p>
</div>
<div id="non-parametric-models-1" class="section level1">
<h1>Non-Parametric models</h1>
<pre><code>## Call: survfit(formula = Surv(time, status) ~ x, data = aml)
## 
##                 x=Maintained 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     9     11       1    0.909  0.0867       0.7541        1.000
##    13     10       1    0.818  0.1163       0.6192        1.000
##    18      8       1    0.716  0.1397       0.4884        1.000
##    23      7       1    0.614  0.1526       0.3769        0.999
##    31      5       1    0.491  0.1642       0.2549        0.946
##    34      4       1    0.368  0.1627       0.1549        0.875
##    48      2       1    0.184  0.1535       0.0359        0.944
## 
##                 x=Nonmaintained 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     5     12       2   0.8333  0.1076       0.6470        1.000
##     8     10       2   0.6667  0.1361       0.4468        0.995
##    12      8       1   0.5833  0.1423       0.3616        0.941
##    23      6       1   0.4861  0.1481       0.2675        0.883
##    27      5       1   0.3889  0.1470       0.1854        0.816
##    30      4       1   0.2917  0.1387       0.1148        0.741
##    33      3       1   0.1944  0.1219       0.0569        0.664
##    43      2       1   0.0972  0.0919       0.0153        0.620
##    45      1       1   0.0000     NaN           NA           NA</code></pre>
</div>
<div id="non-parametric-models---testing" class="section level1">
<h1>Non-Parametric models - testing</h1>
<ul>
<li><p>We can use a non parametric test to understand if group A lives longer than group B</p></li>
<li><p>long-rank test: is the difference in survival times statistically different?</p></li>
<li><p>relying on a <span class="math inline">\(\chi^2\)</span> distribution</p></li>
</ul>
<pre><code>## Call:
## survdiff(formula = Surv(time, status) ~ x, data = aml)
## 
##                  N Observed Expected (O-E)^2/E (O-E)^2/V
## x=Maintained    11        7    10.69      1.27       3.4
## x=Nonmaintained 12       11     7.31      1.86       3.4
## 
##  Chisq= 3.4  on 1 degrees of freedom, p= 0.07</code></pre>
</div>
<div id="non-parametric-models-2" class="section level1">
<h1>Non-Parametric models</h1>
<ul>
<li>Often, more intuitive to look at the results on the cumulative hazard rate</li>
<li>Nelson Aalen cumulative hazard is the most common non parametric estimator</li>
</ul>
<p><img src="static/Course_Modularization/Survival analysis/Slides/ZIN_surv_files/figure-html/unnamed-chunk-6-1.png" width="100%" /></p>
</div>
<div id="semi--parametric-models" class="section level1">
<h1>Semi- Parametric models</h1>
<ul>
<li>Cox proportional hazard model
<ul>
<li>Hazard: the instantaneous risk of an event at time <span class="math inline">\(t\)</span>, conditional on survival to that time.</li>
</ul></li>
<li>Semi:
<ul>
<li>Baseline hazard modelled non parametrically (i.e effect of time)</li>
<li>Covariate effects ( <span class="math inline">\(\beta\)</span> ’s) modelled parametrically (like in a regression model)</li>
</ul></li>
</ul>
<p><span class="math inline">\(h(t) = h_0(t)exp(X\beta)\)</span>
where <span class="math inline">\(h_0(t)\)</span> is estimated non-parametrically</p>
<p>Notice that the effect of the covariates is proportional on the baseline hazard..(that’s why “proportional hazard” model)</p>
</div>
<div id="the-assumption-of-proportional-hazards" class="section level1">
<h1>The assumption of proportional hazards</h1>
<p><img src="figures/Churn.png" width="100%" />
source:<a href="https://altis.com.au/a-crash-course-in-survival-analysis-customer-churn-part-iii/" class="uri">https://altis.com.au/a-crash-course-in-survival-analysis-customer-churn-part-iii/</a></p>
</div>
<div id="assessing-the-proportionality-assumption" class="section level1">
<h1>Assessing the proportionality assumption</h1>
<p>The assumption can be assessed number of ways :
visually
<img src="figures/prop.PNG" width="100%" />
<a href="http://nicedsu.org.uk/wp-content/uploads/2016/03/NICE-DSU-TSD-Survival-analysis.updated-March-2013.v2.pdf" class="uri">http://nicedsu.org.uk/wp-content/uploads/2016/03/NICE-DSU-TSD-Survival-analysis.updated-March-2013.v2.pdf</a></p>
<p>Testing the non-zero slope of the Schoenfeld residuals</p>
</div>
<div id="fully-parametric-models-accelerated-failure-time-models" class="section level1">
<h1>Fully Parametric models (Accelerated Failure Time models)</h1>
<ul>
<li>Usually model time-to-event directly rather than hazard</li>
<li>Resemble a regression model but can capture censoring</li>
<li>Fit a distribution to the (observed) time-to-event data
<ul>
<li>1 parameter : exponential</li>
<li>2 parameter : Weibull, lognormal, gamma etc</li>
<li>3, 4 parameter: Gen. gamma , Gen F etc</li>
</ul></li>
<li>Assumption that censored patients will follow similar patterns to the observed.</li>
<li>Temporal extrapolation possible !</li>
</ul>
</div>
<div id="aft-and-covariates" class="section level1">
<h1>AFT and covariates</h1>
<ul>
<li>We can incorporate covariates in a sort of similar way as we would do in a linear regression model <span class="math inline">\(log(T) = \beta_0 + X\beta_1 + \epsilon\)</span></li>
</ul>
<p><img src="figures/aft.PNG" width="100%" /></p>
</div>
<div id="choosing-the-right-distribution" class="section level1">
<h1>Choosing the “right” distribution</h1>
<ul>
<li>Statistical considerations of goodness-of-fit</li>
<li>Clinical plausibility
<ul>
<li>in-sample</li>
<li>extrapolations</li>
<li>out-of-sample</li>
</ul></li>
</ul>
</div>
<div id="goodness-of-fit-metrics" class="section level1">
<h1>Goodness of fit metrics</h1>
<ul>
<li><p>Likelihood based metrics</p></li>
<li><p>Akaike Information Criterion (AIC)</p></li>
<li><p>Bayesian Information Criterion (BIC)</p></li>
<li><p>Performance based metrics</p></li>
<li><p>Sensitivity , Specificity</p></li>
<li><p>(time dependent) Receiver Operating characteristic (ROC) curve</p></li>
<li><p>Area Under the Curve (AUC)</p></li>
<li><p>c- statistic</p></li>
</ul>
</div>
<div id="choosing-the-right-distribution-1" class="section level1">
<h1>Choosing the “right” distribution</h1>
<ul>
<li>NICE Decision Support Unit</li>
<li>Latimer et al 2011 : Survival Analysis For Economic Evaluations Alongside Clinical Trials - Extrapolation with Patient-Level Data
<ul>
<li><strong>Survival Model Selection Process algorithm</strong>:
<ul>
<li><em>recommendations for how survival analysis can be undertaken more systematically. This involves fitting and testing a range of survival models and comparing these based upon internal validity (how well they fit to the observed trial data) and external validity (how plausible their extrapolated portions are)</em></li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="choosing-the-right-distribution-2" class="section level1">
<h1>Choosing the “right” distribution</h1>
<p>Latimer et al 2011 (DSU 14)</p>
<p><img src="figures/goflatimer.PNG" width="100%" /></p>
</div>
<div id="flexible-survival-models" class="section level1">
<h1>Flexible Survival models</h1>
<ul>
<li>Multi - parameter distributions
<ul>
<li>Generalized Gamma</li>
<li>Generalized F</li>
<li>Data hungry - possibiliy of overfitting<br />
</li>
<li>Hypothesis testing possible</li>
</ul></li>
</ul>
<p><img src="figures/genf.PNG" width="100%" /></p>
</div>
<div id="spline-survival-models" class="section level1">
<h1>Spline Survival models</h1>
<ul>
<li>Survival models where the underlying hazard of an event is modelled as a smooth, piecewise polynomial function of time.</li>
<li>Extrapolation of hazard possible</li>
<li>Non-linear relation of time and hazard</li>
<li>Conventionally <em>knots</em> are evenly spread on the (log)-time axis</li>
<li>Overfitting with too many knots possible -sensitivity analysis</li>
<li>AIC, BIC valid GoF tests</li>
<li>TSD 2020</li>
</ul>
</div>
<div id="spline-survival-models-1" class="section level1">
<h1>Spline Survival models</h1>
<p>Gibson et al (Pharmacoeconomics, 2017)</p>
<p><img src="figures/flexsurv.PNG" width="100%" /></p>
</div>
<div id="spline-survival-models-2" class="section level1">
<h1>Spline Survival models</h1>
<p>From Gibson et al (Pharacoeconomcs, 2017)</p>
<p><em>Spline-based models using a limited number of knots can provide an acceptable fit to trial data and generate extrapolated estimates supported by longer term evidence, with results that are stable in response to changes in knot placement.</em></p>
</div>
<div id="approaches-in-extrapolation" class="section level1">
<h1>Approaches in extrapolation</h1>
<p>Modeler faced with more decisions:
- Extrapolate using KM and “fitted” tails
- Extrapolate using the fitted curve</p>
<ul>
<li>Fit seperate curves to the data</li>
<li>Extrapolate treatment effect as relative</li>
<li>What is the behaviour of the relative effect post trial?</li>
<li>Regardless of the approach, the implied (observed or predicted) treatment effect should be presented</li>
</ul>
</div>
<div id="approaches-in-extrapolation-1" class="section level1">
<h1>Approaches in extrapolation</h1>
<p><img src="figures/endmeans.PNG" width="100%" /></p>
</div>
<div id="approaches-in-extrapolation-2" class="section level1">
<h1>Approaches in extrapolation</h1>
<ul>
<li>Extrapolate using KM and “fitted” tails</li>
</ul>
<p><img src="figures/figure4means.PNG" width="100%" /></p>
<hr />
<ul>
<li>Extrapolate using the fitted curve</li>
</ul>
<p><img src="figures/figure7means.PNG" width="100%" /></p>
</div>
<div id="extrapolating-a-relative-treatment-effect" class="section level1">
<h1>Extrapolating a relative treatment effect</h1>
<p>Drummond, et al (2015). Methods for the economic evaluation of health care programmes. Oxford university press.</p>
<p><img src="figures/drummond.PNG" width="60%" /></p>
<!-- Competing Risks -->
<!-- ======================================================== -->
<!--   - Underlying assumption in survival analysis:  -->
<!--     - If we could follow censored individuals long enough they would experience the event of interest. -->
<!--  - Event B (progression) affecs population size at risk for the competing event C -->
<!-- *** -->
<!-- ```{r, echo = F} -->
<!-- M <- matrix(c(0, 0.5, 0.5, -->
<!--               0, 0, 0, -->
<!--               0, 0, 0), nrow = 3, ncol = 3, byrow = T, -->
<!--             dimnames = list(c("A","B","C"),c("A","B","C"))) -->
<!-- diagram::plotmat(t(M), c(1,2),self.cex = 1, curve = 0,  -->
<!--                  self.shiftx = c(0.08,0.08,0.08), arr.pos = 0.7,   -->
<!--                  latex=T, arr.type = "curved", ,  relsize = 1.1, cex = 0.001, box.cex= 1.7) -->
<!-- ``` -->
<!-- Multistate modeling  -->
<!-- ======================================================== -->
<!--  - Extended form of competing risks -->
<!--  - Multivariate survival analysis -->
<!-- ```{r, echo = F} -->
<!-- M <- matrix(c(0, 0.05, 0.15, -->
<!--               0, 0, 0.2, -->
<!--               0, 0, 0), nrow = 3, ncol = 3, byrow = T, -->
<!--             dimnames = list(c("A","B","C"),c("A","B","C"))) -->
<!-- diagram::plotmat(t(M), c(1,2),self.cex = 1, curve = 0,  -->
<!--                  self.shiftx = c(0.08,0.08,0.08), arr.pos = 0.7,   -->
<!--                  latex=T, arr.type = "curved",  relsize = 1.1, cex = 0.001, box.cex= 1.7) -->
<!-- ``` -->
<!-- Multistate modeling  -->
<!-- ======================================================== -->
<!-- - Extended form of competing risks -->
<!-- - Multivariate survival analysis -->
<!-- - Can incorporate: -->
<!--   - Transition specific covariates -->
<!--   - Recurrent events  -->
<!-- - Can work with  -->
<!--   - Patient-level data (best) -->
<!--   - Digitized / interval censored data (...not best) -->
<!-- Multistate modeling -->
<!-- ======================================================== -->
<!-- Fitted in two ways: -->
<!-- 1. separate models for each trasition -->
<!--   - recurrent events  -->
<!--   - covariates -->
<!--   - seperate dataset for each (non-saturating) state -->
<!--   - "naive" assumption of censoring when competing event occurs -->
<!--   - easy to fit in R `flexsurv` and `mstate` -->
<!-- Multistate modeling -->
<!-- ======================================================== -->
<!-- Fitted in two ways: -->
<!-- 2. Joint multivariate model for all transitions - Powerfull! -->
<!--     - Mislclassification errors -->
<!--     - Latent states  -->
<!--     - Interval censoring -->
<!--     - Continuous time -->
<!-- Drawbacks: -->
<!--  - Difficult to converge -->
<!--  - Limited options wrt assumed distributions (exponential) -->
<!-- Can be fitted through `msm` and `flexsurv` -->
<!-- Multistate modeling -->
<!-- ======================================================== -->
<!-- ```{r, out.width='100%', echo=F} -->
<!-- knitr::include_graphics('figures/jacksonflex.png') -->
<!-- ``` -->
<!-- Great resource for both survival fitting and multistate models -->
<!-- Multistate & microsimulation -->
<!-- ======================================================== -->
<!-- - Multistate models allow for time-dependent transition probabilities  -->
<!-- - When dependence on time-in-state partioned survival / markov models are inadequate   -->
<!-- - Necessary solution: Individual level simulation modeling -->
<!-- ```{r, out.width='100%', echo=F} -->
<!-- knitr::include_graphics('figures/microsim.png') -->
<!-- ``` -->
<!-- Multistate modeling -->
<!-- ======================================================== -->
<!-- ```{r, out.width='100%', echo=F} -->
<!-- knitr::include_graphics('figures/venn.png') -->
<!-- ``` -->
<!-- Multistate modeling -->
<!-- ======================================================== -->
<!-- ```{r, out.width='100%', echo=F} -->
<!-- knitr::include_graphics('figures/msmnice.png') -->
<!-- ``` -->
<!-- Mixture Cure Models - Main Points -->
<!-- ======================================================== -->
<!--  - Therapies with the possibility of cure pose a modeling challenge -->
<!--  - e.g. plateau on immotherapy survival curves  -->
<!--  - Extrapolation challenging without external information  -->
<!--  - Traditional methods: Underestimation more likely than over estimation of the effect -->
<!-- Mixture Cure Models - Main Points  -->
<!-- ======================================================== -->
<!--   - extension of survival models where a proportion of the population is assumed to be "cured"  -->
<!--     - non-cured fraction at risk of progression and death informed by the trial -->
<!--     - cured fraction at risk of death informed by external data.  -->
<!-- ```{r, echo = F, out.width='100%'} -->
<!-- M <- matrix(c(0, 0.05, 0.15,   0, 0.05, -->
<!--               0,    0,    0, 0.3, 0.05, -->
<!--               0,    0,    0,   0, 0.05, -->
<!--               0,    0,    0,   0,    0, -->
<!--               0,    0,    0,   0,    0), nrow = 5, ncol = 5, byrow = T, -->
<!--             dimnames = list(c("Healthy","Progression","Cure", "Disease Death", "Other Death"), -->
<!--                             c("Healthy","Progression","Cure", "Disease Death", "Other Death "))) -->
<!-- diagram::plotmat(t(M), c(3,2), self.cex = 1, curve = 0,  -->
<!--                  self.shiftx = c(0.08,0.08,0.08,0.08,0.08), arr.pos = 0.7,   -->
<!--                  latex=T, arr.type = "curved", relsize = 1.1, cex = 0.001, box.cex= 1.2) -->
<!-- ``` -->
<!-- Mixture Cure Models - Estimation -->
<!-- ======================================================== -->
<!-- - Cure rate models a promising solution but the cure faction difficult to estimate -->
<!-- - Can be fitted in both R and SAS -->
<!-- - Guidance is lacking but given the popularity soon to come! -->
</div>
