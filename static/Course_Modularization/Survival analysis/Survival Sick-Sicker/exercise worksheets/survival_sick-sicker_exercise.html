---
title: "Cost-Effectiveness and Decision Modeling in R"
author: "The DARTH workgroup"
subtitle: Exercises – Survival analysis in Decision modeling   
output:
  pdf_document: default
  word_document: default
  html_document: default
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>Developed by the Decision Analysis in R for Technologies in Health (DARTH) workgroup:</p>
<p>Fernando Alarid-Escudero, PhD (1)</p>
<p>Eva A. Enns, MS, PhD (2)</p>
<p>M.G. Myriam Hunink, MD, PhD (3,4)</p>
<p>Hawre J. Jalal, MD, PhD (5)</p>
<p>Eline M. Krijkamp, MSc (3)</p>
<p>Petros Pechlivanoglou, PhD (6)</p>
<p>Alan Yang, MSc (7)</p>
<p>In collaboration of:</p>
<ol style="list-style-type: decimal">
<li>Drug Policy Program, Center for Research and Teaching in Economics (CIDE) - CONACyT,
Aguascalientes, Mexico</li>
<li>University of Minnesota School of Public Health, Minneapolis, MN, USA</li>
<li>Erasmus MC, Rotterdam, The Netherlands</li>
<li>Harvard T.H. Chan School of Public Health, Boston, USA</li>
<li>University of Pittsburgh Graduate School of Public Health, Pittsburgh, PA, USA</li>
<li>The Hospital for Sick Children, Toronto and University of Toronto, Toronto ON, Canada</li>
<li>The Hospital for Sick Children, Toronto ON, Canada</li>
</ol>
<p>Please cite our publications when using this code:</p>
<ul>
<li><p>Jalal H, Pechlivanoglou P, Krijkamp E, Alarid-Escudero F, Enns E, Hunink MG.
An Overview of R in Health Decision Sciences. Med Decis Making. 2017; 37(3): 735-746.
<a href="https://journals.sagepub.com/doi/abs/10.1177/0272989X16686559" class="uri">https://journals.sagepub.com/doi/abs/10.1177/0272989X16686559</a></p></li>
<li><p>Krijkamp EM, Alarid-Escudero F, Enns EA, Jalal HJ, Hunink MGM, Pechlivanoglou P.
Microsimulation modeling for health decision sciences using R: A tutorial.
Med Decis Making. 2018;38(3):400–22.
<a href="https://journals.sagepub.com/doi/abs/10.1177/0272989X18754513" class="uri">https://journals.sagepub.com/doi/abs/10.1177/0272989X18754513</a></p></li>
<li><p>Krijkamp EM, Alarid-Escudero F, Enns E, Pechlivanoglou P, Hunink MM, Jalal H. A Multidimensional Array Representation of State-Transition Model Dynamics. Med Decis Mak. 2020;40(2):242-248. <a href="doi:10.1177/0272989X19893973" class="uri">doi:10.1177/0272989X19893973</a></p></li>
</ul>
<p>Copyright 2017, THE HOSPITAL FOR SICK CHILDREN AND THE COLLABORATING INSTITUTIONS.
All rights reserved in Canada, the United States and worldwide. Copyright,
trademarks, trade names and any and all associated intellectual property are
exclusively owned by THE HOSPITAL FOR Sick CHILDREN and the collaborating
institutions. These materials may be used, reproduced, modified, distributed
and adapted with proper attribution.</p>
<div id="exercise-a-microsimulation-model-the-sick-sicker-model" class="section level1">
<h1>Exercise: A Microsimulation model – The Sick-Sicker model</h1>
<p>In this exercise, we will model a hypothetical disease that affects individuals with an average age of 25 years and results in increased mortality, increased healthcare costs, and reduced quality of life. The disease has two levels; affected individuals initially become sick but can subsequently progress and become sicker. Two alternative strategies exist for this hypothetical disease: a no-treatment and a treatment strategy. Under the treatment strategy, individuals in the sick and sicker states are treated until they recover (only if sick; individuals in the sicker state cannot recover) or die. The cost of the treatment is additive to the baseline healthcare costs of being sick or sicker. The treatment improves quality of life for those individuals who are sick but has no impact on the quality of life of those who are sicker. Unfortunately, it is not possible to reliably differentiate between people in the sick and sicker states, so treatment cannot be targeted to only those in the sick state. You are asked to evaluate the cost-effectiveness of the treatment.</p>
<p>To model this disease, we will rely on a microsimulation model, called the Sick-Sicker model, first described by Enns et al. The Sick-Sicker model consists of four health states: Healthy (H), two disease states, Sick (S1) and Sicker (S2), and Dead (D) (Figure 1). All individuals start in the Healthy state. Over time, healthy individuals may develop the disease and can progress to S1. Individuals in S1 can recover (return to state H), progress further to S2 or die. Individuals in S2 cannot recover (i.e. cannot transition to either S1 or H). Individuals in H have a baseline probability of death; individuals in S1 and S2 experience increased mortality compared to those in the H state, given in terms of hazard ratios. These ratios are used to calculate the probabilities of dying when in S1 and S2.</p>
<p>You were given access to individual-level data of patients with the hypothetical disease. From the data you are asked to inform the transition probabilities for the transitions from S1 to H, from S1 to S2 and from S1 to D directly from the data through the use of parametric survival functions. A snapshot of the data is presented below:</p>
<pre><code>##   id from to       time status
## 1  1   S1  D 1.33364908      0
## 2  2   S1  D 0.05171561      0
## 3  3   S1  D 0.41385598      0
## 4  4   S1  D 0.70685885      0
## 5  5   S1  D 0.29203659      0
## 6  6   S1  D 3.19731116      0</code></pre>
<div id="tasks" class="section level2">
<h2>Tasks</h2>
<p><strong>Part 1</strong></p>
<ol style="list-style-type: decimal">
<li><p>Use the <code>R</code> script <code>Survival_Sick_Sicker_template.R</code> as a starting point to code the survival analysis solution to the Sick-Sicker model.</p></li>
<li><p>Load the individual level data in long form from the <code>data_long_Sicker.csv</code> file.</p></li>
<li><p>Subset the data by transition so that you can fit separate models for each transition.</p></li>
<li><p>Draw Kaplan Meier plots for each transition.</p></li>
<li><p>Estimate parametric distributions to the patient level survival data for all data-informed transitions.</p></li>
<li><p>Select the one with the most plausible fit (both clinically and statistically).</p></li>
</ol>
<p><strong>OPTIONAL</strong></p>
<ol style="list-style-type: decimal">
<li><p>Incorporate the transition probabilities extracted from the survival analysis model to the Sick Sicker time microsimulation. HINT: Depending on the distribution you choose for the survival model you will need to track more time-in-state variables.</p></li>
<li><p>Run the microsimulation model and draw output from it.</p></li>
</ol>
<p><strong>Table 1: Input parameters for the time dependent Sick-Sicker Microsimulation </strong></p>
<table>
<colgroup>
<col width="56%" />
<col width="20%" />
<col width="23%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><strong>Parameter</strong></th>
<th align="left"><strong>R name</strong></th>
<th align="center"><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Time horizon</td>
<td align="left"><code>n_t</code></td>
<td align="center">30 years</td>
</tr>
<tr class="even">
<td align="left">Cycle length</td>
<td align="left"></td>
<td align="center">1 year</td>
</tr>
<tr class="odd">
<td align="left">Names of simulated individuals</td>
<td align="left"><code>n_i</code></td>
<td align="center">1000</td>
</tr>
<tr class="even">
<td align="left">Names of health states</td>
<td align="left"><code>v_n</code></td>
<td align="center">H, S1, S2, D</td>
</tr>
<tr class="odd">
<td align="left">Annual discount rate (costs/QALYs)</td>
<td align="left"><code>d_r</code></td>
<td align="center">3%</td>
</tr>
<tr class="even">
<td align="left">Population characteristics</td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="left">- Agedistribution</td>
<td align="left">–</td>
<td align="center">Range:25-55 distributed as in <code>MyPopulation-AgeDistribution.csv</code></td>
</tr>
<tr class="even">
<td align="left">Annual transition probabilities</td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="left">- Disease onset (H to S1)</td>
<td align="left"><code>p_HS1</code></td>
<td align="center">0.15</td>
</tr>
<tr class="even">
<td align="left">Annual mortality</td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="left">- All-cause mortality (H to D)</td>
<td align="left"><code>p_HD</code></td>
<td align="center">Human Mortality Database: age dependent from 2015</td>
</tr>
<tr class="even">
<td align="left">Annual costs</td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="left">- Healthy individuals</td>
<td align="left"><code>c_H</code></td>
<td align="center">$2,000</td>
</tr>
<tr class="even">
<td align="left">- Sick individuals in S1</td>
<td align="left"><code>c_S1</code></td>
<td align="center">$4,000</td>
</tr>
<tr class="odd">
<td align="left">- Sick individuals in S2</td>
<td align="left"><code>c_S2</code></td>
<td align="center">$15,000</td>
</tr>
<tr class="even">
<td align="left">- Dead individuals</td>
<td align="left"><code>c_D</code></td>
<td align="center">$0</td>
</tr>
<tr class="odd">
<td align="left">- Additional costs of sick individuals treated in S1 or S2</td>
<td align="left"><code>c_trt</code></td>
<td align="center">$12,000</td>
</tr>
<tr class="even">
<td align="left">Utility weights</td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="left">- Healthy individuals</td>
<td align="left"><code>u_H</code></td>
<td align="center">1.00</td>
</tr>
<tr class="even">
<td align="left">- Sick individuals in S1</td>
<td align="left"><code>u_S1</code></td>
<td align="center">0.75</td>
</tr>
<tr class="odd">
<td align="left">- Sick individuals in S2</td>
<td align="left"><code>u_S2</code></td>
<td align="center">0.50</td>
</tr>
<tr class="even">
<td align="left">- Dead individuals</td>
<td align="left"><code>u_D</code></td>
<td align="center">0.00</td>
</tr>
<tr class="odd">
<td align="left">Intervention effect</td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="left">- Utility for treated individuals in S1</td>
<td align="left"><code>u_trt</code></td>
<td align="center">0.95</td>
</tr>
<tr class="odd">
<td align="left">Time varying extension of Sick-Sicker model</td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="left">- Treatment effect modifier at baseline</td>
<td align="left"><code>v_x</code></td>
<td align="center">Uniform(0.95, 1.05)</td>
</tr>
</tbody>
</table>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-2"></span>
<img src="/Users/elinekrijkamp/Documents/GitHub/Course-Modularization/static/Course_Modularization/Survival%20analysis/Survival%20Sick-Sicker/figures/sick_sicker_diagram.png" alt="Schematic representation of the Sick-Sicker model" width="100%" />
<p class="caption">
Figure 1: Schematic representation of the Sick-Sicker model
</p>
</div>
</div>
</div>
